<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Molecular dynamics application example &#8212; CommonNN Clustering  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a5519fdd" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=77a3bc79" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=d18eccf6" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API Reference" href="../_source/api_reference.html" />
    <link rel="prev" title="Density-based clustering basics" href="algorithm_explained.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <style>
    .nbinput .prompt,
    .nboutput .prompt {
        display: none;
    }
</style><section id="Molecular-dynamics-application-example">
<h1>Molecular dynamics application example<a class="headerlink" href="#Molecular-dynamics-application-example" title="Link to this heading">¶</a></h1>
<p>Go to:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#Notebook-configuration"><span class="std std-ref">Notebook configuration</span></a></p></li>
<li><p><a class="reference internal" href="#Helper-functions"><span class="std std-ref">Helper functions</span></a></p></li>
<li><p>The C-type lectin receptor langerin</p></li>
<li><p><a class="reference internal" href="#Preliminary-checks"><span class="std std-ref">Preliminary checks</span></a></p></li>
<li><p><a class="reference internal" href="#Clustering-root-data"><span class="std std-ref">Clustering root data</span></a></p></li>
<li><p><a class="reference internal" href="#Semi-automatic-hierarchical-clustering"><span class="std std-ref">Semi-automatic hierarchical clustering</span></a></p></li>
<li><p><a class="reference internal" href="#Automatic-hierarchical-clustering"><span class="std std-ref">Automatic hierarchical clustering</span></a></p></li>
</ul>
<section id="Notebook-configuration">
<h2>Notebook configuration<a class="headerlink" href="#Notebook-configuration" title="Link to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mpl</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sklearn</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.neighbors</span><span class="w"> </span><span class="kn">import</span> <span class="n">KDTree</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.metrics</span><span class="w"> </span><span class="kn">import</span> <span class="n">pairwise_distances</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tqdm.notebook</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">commonnn</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">commonnn</span><span class="w"> </span><span class="kn">import</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">plot</span><span class="p">,</span> <span class="n">recipes</span><span class="p">,</span> <span class="n">_types</span><span class="p">,</span> <span class="n">_fit</span><span class="p">,</span> <span class="n">_bundle</span>
</pre></div>
</div>
</div>
<p>Print Python and package version information:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Version information</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Python: &quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Packages:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">package</span> <span class="ow">in</span> <span class="p">[</span><span class="n">mpl</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="n">sklearn</span><span class="p">,</span> <span class="n">commonnn</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">package</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">package</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Python:  3.9.0 | packaged by conda-forge | (default, Nov 26 2020, 07:57:39)  [GCC 9.3.0]
Packages:
    matplotlib: 3.9.4
    numpy: 1.26.4
    sklearn: 1.6.1
    commonnn: 0.0.4
</pre></div></div>
</div>
<p>We use <a class="reference external" href="https://matplotlib.org/">Matplotlib</a> to create plots. The <code class="docutils literal notranslate"><span class="pre">matplotlibrc</span></code> file in the root directory of the <code class="docutils literal notranslate"><span class="pre">CommonNNClustering</span></code> repository is used to customize the appearance of the plots.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Matplotlib configuration</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rc_file</span><span class="p">(</span>
    <span class="s2">&quot;../../matplotlibrc&quot;</span><span class="p">,</span>
    <span class="n">use_default_template</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Axis property defaults for the plots</span>
<span class="n">ax_props</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;xlabel&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s2">&quot;ylabel&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s2">&quot;xticks&quot;</span><span class="p">:</span> <span class="p">(),</span>
    <span class="s2">&quot;yticks&quot;</span><span class="p">:</span> <span class="p">(),</span>
    <span class="s2">&quot;aspect&quot;</span><span class="p">:</span> <span class="s2">&quot;equal&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</section>
<section id="Helper-functions">
<h2>Helper functions<a class="headerlink" href="#Helper-functions" title="Link to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">draw_evaluate</span><span class="p">(</span><span class="n">clustering</span><span class="p">,</span> <span class="n">axis_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">plot_style</span><span class="o">=</span><span class="s2">&quot;dots&quot;</span><span class="p">):</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">Ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
        <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span>
        <span class="n">figsize</span><span class="o">=</span><span class="p">(</span>
            <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.5</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">dim_</span> <span class="o">=</span> <span class="p">(</span><span class="n">dim</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dim</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

        <span class="n">ax_props_</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">ax_props</span><span class="p">}</span>
        <span class="k">if</span> <span class="n">axis_labels</span><span class="p">:</span>
            <span class="n">ax_props_</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">{</span><span class="s2">&quot;xlabel&quot;</span><span class="p">:</span> <span class="n">dim_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;ylabel&quot;</span><span class="p">:</span> <span class="n">dim_</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">}</span>
            <span class="p">)</span>

        <span class="n">_</span> <span class="o">=</span> <span class="n">clustering</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">Ax</span><span class="p">[</span><span class="n">dim</span><span class="p">],</span>
            <span class="n">plot_style</span><span class="o">=</span><span class="n">plot_style</span><span class="p">,</span>
            <span class="n">ax_props</span><span class="o">=</span><span class="n">ax_props_</span><span class="p">,</span>
            <span class="n">dim</span><span class="o">=</span><span class="n">dim_</span>
            <span class="p">)</span>

        <span class="n">Ax</span><span class="p">[</span><span class="n">dim</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_label</span><span class="p">()</span><span class="o">.</span><span class="n">set_rotation</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</section>
<section id="The-C-type-lectin-receptor-langerin">
<h2>The C-type lectin receptor langerin<a class="headerlink" href="#The-C-type-lectin-receptor-langerin" title="Link to this heading">¶</a></h2>
<p>Let’s read in some “real world” data for this example. We will work with a 6D projection from a classical MD trajectory of the C-type lectin receptor langerin that was generated by the dimension reduction procedure TICA.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">langerin</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">Clustering</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;md_example/langerin_projection.npy&quot;</span><span class="p">,</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">alias</span><span class="o">=</span><span class="s2">&quot;C-type lectin langerin&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<p>After creating a <code class="docutils literal notranslate"><span class="pre">Clustering</span></code> instance, we can print out basic information about the data. The projection comes in 116 parts of individual independent simulations. In total we have about 26,000 data points in this set representing 26 microseconds of simulation time at a sampling timestep of 1 nanoseconds.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">langerin</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
alias: &#39;root&#39;
hierarchy_level: 0
access: components
points: 26528
children: 0
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">langerin</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">_input_data</span><span class="o">.</span><span class="n">meta</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;access_components&#39;: True, &#39;edges&#39;: [56, 42, 209, 1000, 142, 251, 251, 251, 251, 251, 251, 251, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 144, 636, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221, 221]}
</pre></div></div>
</div>
<p>Dealing with six data dimensions we can still visualise the data quite well.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">draw_evaluate</span><span class="p">(</span><span class="n">langerin</span><span class="p">,</span> <span class="n">axis_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">plot_style</span><span class="o">=</span><span class="s2">&quot;contourf&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_md_example_18_0.png" src="../_images/tutorial_md_example_18_0.png" />
</div>
</div>
<p>After a few preliminary checks, we will partition that data by 1-step threshold-based clustering and then also by using a semi-automatic and an automatic hierarchical clustering approach for comparison.</p>
</section>
<section id="Preliminary-checks">
<h2>Preliminary checks<a class="headerlink" href="#Preliminary-checks" title="Link to this heading">¶</a></h2>
<p>So let’s begin. A quick look on the distribution of distances in the set gives us a first feeling for what might be a suitable value for the neighbour search radius <em>r</em>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Keep only upper triangle of the distance matrix to deduplicate</span>
<span class="n">distances</span> <span class="o">=</span> <span class="n">pairwise_distances</span><span class="p">(</span>
    <span class="n">langerin</span><span class="o">.</span><span class="n">input_data</span>
<span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">triu_indices</span><span class="p">(</span><span class="n">langerin</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">_input_data</span><span class="o">.</span><span class="n">n_points</span><span class="p">)]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">plot_histogram</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">distances</span><span class="p">,</span> <span class="n">maxima</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">maxima_props</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;order&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">})</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_md_example_22_0.png" src="../_images/tutorial_md_example_22_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[61]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Free memory</span>
<span class="o">%</span><span class="k">xdel</span> distances
</pre></div>
</div>
</div>
<p>We can suspect that values of <em>r</em> of roughly 2 or lower should be a good starting point. The maximum in the distribution closest to 0 defines a reasonable value range for <span class="math notranslate nohighlight">\(r\)</span>. We can also get a feeling for what values <span class="math notranslate nohighlight">\(n_\mathrm{c}\)</span> could take on by checking the number of neighbours each point has for a given search radius.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[62]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Can take a couple of minutes...</span>
<span class="n">min_n</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">max_n</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">mean_n</span> <span class="o">=</span> <span class="p">[]</span>


<span class="n">tree</span> <span class="o">=</span> <span class="n">KDTree</span><span class="p">(</span><span class="n">langerin</span><span class="o">.</span><span class="n">input_data</span><span class="p">)</span>
<span class="n">r_list</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">3.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span>
<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">r_list</span><span class="p">):</span>
    <span class="n">n_neighbours</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">query_radius</span><span class="p">(</span>
            <span class="n">langerin</span><span class="o">.</span><span class="n">input_data</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">return_distance</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
    <span class="p">]</span>

    <span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="mf">2.0</span><span class="p">:</span>
        <span class="n">n_neighbours_highlight</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">n_neighbours</span><span class="p">)</span>

    <span class="n">min_n</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">n_neighbours</span><span class="p">))</span>
    <span class="n">max_n</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">n_neighbours</span><span class="p">))</span>
    <span class="n">mean_n</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">n_neighbours</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "b8dd07bd219f492a99944cb3818047c5", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyboardInterrupt</span>                         Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[62], line 12</span>
<span class="ansi-green-intense-fg ansi-bold">      8</span> r_list <span style="color: rgb(98,98,98)">=</span> np<span style="color: rgb(98,98,98)">.</span>arange(<span style="color: rgb(98,98,98)">0.25</span>, <span style="color: rgb(98,98,98)">3.25</span>, <span style="color: rgb(98,98,98)">0.25</span>)
<span class="ansi-green-intense-fg ansi-bold">      9</span> <span class="ansi-bold" style="color: rgb(0,135,0)">for</span> r <span class="ansi-bold" style="color: rgb(175,0,255)">in</span> tqdm(r_list):
<span class="ansi-green-intense-fg ansi-bold">     10</span>     n_neighbours <span style="color: rgb(98,98,98)">=</span> [
<span class="ansi-green-intense-fg ansi-bold">     11</span>         x<span style="color: rgb(98,98,98)">.</span>shape[<span style="color: rgb(98,98,98)">0</span>]
<span class="ansi-green-fg">---&gt; 12</span>         <span class="ansi-bold" style="color: rgb(0,135,0)">for</span> x <span class="ansi-bold" style="color: rgb(175,0,255)">in</span> <span class="ansi-yellow-bg">tree</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">query_radius</span><span class="ansi-yellow-bg">(</span>
<span class="ansi-green-intense-fg ansi-bold">     13</span> <span class="ansi-yellow-bg">            </span><span class="ansi-yellow-bg">langerin</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">.</span><span class="ansi-yellow-bg">input_data</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">r</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">return_distance</span><span class="ansi-yellow-bg" style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg ansi-bold" style="color: rgb(0,135,0)">False</span>
<span class="ansi-green-intense-fg ansi-bold">     14</span> <span class="ansi-yellow-bg">        </span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     15</span>     ]
<span class="ansi-green-intense-fg ansi-bold">     17</span>     <span class="ansi-bold" style="color: rgb(0,135,0)">if</span> r <span style="color: rgb(98,98,98)">==</span> <span style="color: rgb(98,98,98)">2.0</span>:
<span class="ansi-green-intense-fg ansi-bold">     18</span>         n_neighbours_highlight <span style="color: rgb(98,98,98)">=</span> np<span style="color: rgb(98,98,98)">.</span>copy(n_neighbours)

<span class="ansi-red-fg">KeyboardInterrupt</span>:
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">h</span><span class="p">,</span> <span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">n_neighbours_highlight</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">e</span> <span class="o">=</span> <span class="p">(</span><span class="n">e</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="c1"># ax.plot([2.0, 2.0], (e[0], e[-1]), &quot;k&quot;)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_betweenx</span><span class="p">(</span>
    <span class="n">e</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">),</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="n">h</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
    <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span>
<span class="p">)</span>
<span class="n">min_line</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_list</span><span class="p">,</span> <span class="n">min_n</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">)</span>
<span class="n">max_line</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_list</span><span class="p">,</span> <span class="n">max_n</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">)</span>
<span class="n">mean_line</span><span class="p">,</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">r_list</span><span class="p">,</span> <span class="n">mean_n</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span>
    <span class="p">[</span><span class="n">min_line</span><span class="p">,</span> <span class="n">mean_line</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;min/max&quot;</span><span class="p">,</span> <span class="s2">&quot;mean&quot;</span><span class="p">],</span>
    <span class="n">fancybox</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;k&quot;</span>
<span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="p">{</span>
    <span class="s2">&quot;xlim&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">r_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
    <span class="s2">&quot;xlabel&quot;</span><span class="p">:</span> <span class="s2">&quot;$r$&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ylabel&quot;</span><span class="p">:</span> <span class="s2">&quot;#neighbours&quot;</span><span class="p">,</span>
<span class="p">})</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[(0.25, 3.0), Text(0.5, 0, &#39;$r$&#39;), Text(0, 0.5, &#39;#neighbours&#39;)]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_md_example_26_1.png" src="../_images/tutorial_md_example_26_1.png" />
</div>
</div>
<p>In the radius value regime of 2 and higher the number of neighbours per point quickly approaches the number of points in the whole data set. We can interpret these plots as upper bounds (max: hard bound; mean: soft bound) for <span class="math notranslate nohighlight">\(n_\mathrm{c}\)</span> if <span class="math notranslate nohighlight">\(r\)</span> varies. Values of <span class="math notranslate nohighlight">\(n_\mathrm{c}\)</span> much larger than say 5000 probably wont make to much sense for radii below around 2.0. If the radius cutoff is set to <span class="math notranslate nohighlight">\(r=1\)</span>, <span class="math notranslate nohighlight">\(n_\mathrm{c}\)</span> is already capped at a few hundreds. We can also
see that for a radius of 2.0, a substantial amount of the data points have only very few neighbours. Care has to be taken that we do not loose an interesting portion of the feature space here when this radius is used.</p>
</section>
<section id="Clustering-root-data">
<h2>Clustering root data<a class="headerlink" href="#Clustering-root-data" title="Link to this heading">¶</a></h2>
<p>Let’s attempt a first clustering step with a relatively low density criterion (large <em>r</em> cutoff, low number of common neighbours <span class="math notranslate nohighlight">\(n_\mathrm{c}\)</span>). When we cluster, we can judge the outcome by how many clusters we obtain and how many points end up as being classified as noise. For the first clustering steps, it can be a good idea to start with a low density cutoff and then increase it gradually (preferably by keeping <span class="math notranslate nohighlight">\(r\)</span> constant and increasing <span class="math notranslate nohighlight">\(n_\mathrm{c}\)</span>). As we choose
higher density criteria the number of resulting clusters will rise and so will the noise level. We need to find the point where we yield a large number of (reasonably sized) clusters without loosing relevant information in the noise regions. Keep in mind that the ideal number of clusters and noise ratio are not definable and highly dependent on the nature of the data and your (subjective) expectation if there is no dedicated way of clustering validation.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Use a fast clustering recipe here</span>
<span class="n">r</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="n">neighbourhoods</span><span class="p">,</span> <span class="n">sort_order</span><span class="p">,</span> <span class="n">revert_order</span> <span class="o">=</span> <span class="n">recipes</span><span class="o">.</span><span class="n">sorted_neighbourhoods_from_coordinates</span><span class="p">(</span><span class="n">langerin</span><span class="o">.</span><span class="n">input_data</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">sort_by</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">)</span>
<span class="n">langerin_neighbourhoods</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">Clustering</span><span class="p">(</span>
    <span class="n">neighbourhoods</span><span class="p">,</span> <span class="n">recipe</span><span class="o">=</span><span class="s2">&quot;sorted_neighbourhoods&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">langerin_neighbourhoods</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">radius_cutoff</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">similarity_cutoff</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">member_cutoff</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">langerin</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">langerin_neighbourhoods</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">revert_order</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
-----------------------------------------------------------------------------------------------
#points   r         nc        min       max       #clusters %largest  %noise    time
26528     1.500     2         10        None      11        0.702     0.005     00:00:0.311
-----------------------------------------------------------------------------------------------

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">draw_evaluate</span><span class="p">(</span><span class="n">langerin</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_md_example_32_0.png" src="../_images/tutorial_md_example_32_0.png" />
</div>
</div>
<p>We obtain a low number of noise points and a handful of clusters so we are at least not completely of track here with our initial guess on <span class="math notranslate nohighlight">\(r\)</span>. To get a better feeling for how the clustering changes with higher density-thresholds, one could scan a few more parameter combinations.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">1</span><span class="p">)):</span>
    <span class="n">langerin_neighbourhoods</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">radius_cutoff</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">similarity_cutoff</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">member_cutoff</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">langerin</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">_summary</span> <span class="o">=</span> <span class="n">langerin_neighbourhoods</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">_summary</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "d90fe63845694a0088151e6c106fe2f7", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">langerin</span><span class="o">.</span><span class="n">summary</span><span class="o">.</span><span class="n">to_DataFrame</span><span class="p">()</span>
<span class="n">df</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>n_points</th>
      <th>radius_cutoff</th>
      <th>similarity_cutoff</th>
      <th>member_cutoff</th>
      <th>max_clusters</th>
      <th>n_clusters</th>
      <th>ratio_largest</th>
      <th>ratio_noise</th>
      <th>execution_time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>26528</td>
      <td>1.5</td>
      <td>2</td>
      <td>10</td>
      <td>&lt;NA&gt;</td>
      <td>11</td>
      <td>0.702201</td>
      <td>0.005428</td>
      <td>0.482993</td>
    </tr>
    <tr>
      <th>1</th>
      <td>26528</td>
      <td>1.5</td>
      <td>2</td>
      <td>10</td>
      <td>&lt;NA&gt;</td>
      <td>11</td>
      <td>0.702201</td>
      <td>0.005428</td>
      <td>0.442934</td>
    </tr>
    <tr>
      <th>2</th>
      <td>26528</td>
      <td>1.5</td>
      <td>2</td>
      <td>10</td>
      <td>&lt;NA&gt;</td>
      <td>11</td>
      <td>0.702201</td>
      <td>0.005428</td>
      <td>0.465871</td>
    </tr>
    <tr>
      <th>3</th>
      <td>26528</td>
      <td>1.5</td>
      <td>2</td>
      <td>10</td>
      <td>&lt;NA&gt;</td>
      <td>11</td>
      <td>0.702201</td>
      <td>0.005428</td>
      <td>0.348964</td>
    </tr>
    <tr>
      <th>4</th>
      <td>26528</td>
      <td>1.5</td>
      <td>2</td>
      <td>10</td>
      <td>&lt;NA&gt;</td>
      <td>11</td>
      <td>0.702201</td>
      <td>0.005428</td>
      <td>0.341427</td>
    </tr>
    <tr>
      <th>5</th>
      <td>26528</td>
      <td>1.5</td>
      <td>2</td>
      <td>10</td>
      <td>&lt;NA&gt;</td>
      <td>11</td>
      <td>0.702201</td>
      <td>0.005428</td>
      <td>0.339944</td>
    </tr>
    <tr>
      <th>6</th>
      <td>26528</td>
      <td>1.5</td>
      <td>2</td>
      <td>10</td>
      <td>&lt;NA&gt;</td>
      <td>11</td>
      <td>0.702201</td>
      <td>0.005428</td>
      <td>0.34093</td>
    </tr>
    <tr>
      <th>7</th>
      <td>26528</td>
      <td>1.5</td>
      <td>2</td>
      <td>10</td>
      <td>&lt;NA&gt;</td>
      <td>11</td>
      <td>0.702201</td>
      <td>0.005428</td>
      <td>0.340496</td>
    </tr>
    <tr>
      <th>8</th>
      <td>26528</td>
      <td>1.5</td>
      <td>2</td>
      <td>10</td>
      <td>&lt;NA&gt;</td>
      <td>11</td>
      <td>0.702201</td>
      <td>0.005428</td>
      <td>0.341145</td>
    </tr>
    <tr>
      <th>9</th>
      <td>26528</td>
      <td>1.5</td>
      <td>2</td>
      <td>10</td>
      <td>&lt;NA&gt;</td>
      <td>11</td>
      <td>0.702201</td>
      <td>0.005428</td>
      <td>0.340906</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c_values</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;similarity_cutoff&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">n_cluster_values</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;n_clusters&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c_values</span><span class="p">,</span> <span class="n">n_cluster_values</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="p">{</span>
    <span class="s2">&quot;xlim&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">c_values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c_values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
    <span class="s2">&quot;xlabel&quot;</span><span class="p">:</span> <span class="s2">&quot;$c$&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ylabel&quot;</span><span class="p">:</span> <span class="s2">&quot;#clusters&quot;</span><span class="p">,</span>
    <span class="s2">&quot;yticks&quot;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">n_cluster_values</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">n_cluster_values</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">})</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_md_example_36_0.png" src="../_images/tutorial_md_example_36_0.png" />
</div>
</div>
<p>As we see here, increasing <span class="math notranslate nohighlight">\(n_\mathrm{c}\)</span> and therefore the density-threshold only yields less clusters which potentially means we are starting to loose information. To be sure, we can also double check the result with a somewhat larger radius to exclude that we already lost potential clusters with our first parameter combination.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">neighbourhoods</span><span class="p">,</span> <span class="n">sort_order</span><span class="p">,</span> <span class="n">revert_order</span> <span class="o">=</span> <span class="n">recipes</span><span class="o">.</span><span class="n">sorted_neighbourhoods_from_coordinates</span><span class="p">(</span><span class="n">langerin</span><span class="o">.</span><span class="n">input_data</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">sort_by</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">)</span>
<span class="n">langerin_neighbourhoods</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">Clustering</span><span class="p">(</span>
    <span class="n">neighbourhoods</span><span class="p">,</span> <span class="n">recipe</span><span class="o">=</span><span class="s2">&quot;sorted_neighbourhoods&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[64]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="mi">1</span><span class="p">)):</span>
    <span class="n">langerin_neighbourhoods</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">radius_cutoff</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">similarity_cutoff</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">member_cutoff</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">langerin</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">_summary</span> <span class="o">=</span> <span class="n">langerin_neighbourhoods</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">_summary</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "9fe1e9a1796e4372bbaf2a8882575043", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[65]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">langerin</span><span class="o">.</span><span class="n">summary</span><span class="o">.</span><span class="n">to_DataFrame</span><span class="p">()</span>

<span class="n">c_values</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;similarity_cutoff&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">n_cluster_values</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;n_clusters&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c_values</span><span class="p">,</span> <span class="n">n_cluster_values</span><span class="p">,</span> <span class="s2">&quot;k&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="p">{</span>
    <span class="s2">&quot;xlim&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">c_values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c_values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
    <span class="s2">&quot;xlabel&quot;</span><span class="p">:</span> <span class="s2">&quot;$c$&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ylabel&quot;</span><span class="p">:</span> <span class="s2">&quot;#clusters&quot;</span><span class="p">,</span>
    <span class="s2">&quot;yticks&quot;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">n_cluster_values</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">n_cluster_values</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="p">})</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[65]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[(0.0, 104.0),
 Text(0.5, 0, &#39;$c$&#39;),
 Text(0, 0.5, &#39;#clusters&#39;),
 [&lt;matplotlib.axis.YTick at 0x7fab186c0ca0&gt;,
  &lt;matplotlib.axis.YTick at 0x7fab19506910&gt;,
  &lt;matplotlib.axis.YTick at 0x7fab1a895d60&gt;,
  &lt;matplotlib.axis.YTick at 0x7fab186f4340&gt;]]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_md_example_40_1.png" src="../_images/tutorial_md_example_40_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">langerin_neighbourhoods</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">radius_cutoff</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">similarity_cutoff</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">member_cutoff</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">langerin</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">langerin_neighbourhoods</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">revert_order</span><span class="p">]</span>
<span class="n">draw_evaluate</span><span class="p">(</span><span class="n">langerin</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
-----------------------------------------------------------------------------------------------
#points   r         nc        min       max       #clusters %largest  %noise    time
26528     2.000     1         10        None      8         0.962     0.001     00:00:0.691
-----------------------------------------------------------------------------------------------

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_md_example_41_1.png" src="../_images/tutorial_md_example_41_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[48]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">langerin_neighbourhoods</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">radius_cutoff</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">similarity_cutoff</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">member_cutoff</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">langerin</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">langerin_neighbourhoods</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">revert_order</span><span class="p">]</span>
<span class="n">draw_evaluate</span><span class="p">(</span><span class="n">langerin</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
-----------------------------------------------------------------------------------------------
#points   r         nc        min       max       #clusters %largest  %noise    time
26528     2.000     5         10        None      9         0.962     0.002     00:00:0.696
-----------------------------------------------------------------------------------------------

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_md_example_42_1.png" src="../_images/tutorial_md_example_42_1.png" />
</div>
</div>
<p>It looks like we obtain no additional cluster with the larger radius that is lost for the smaller one. For now we can deliberately stick with the smaller radius. We could now use manual hierarchical clustering to freeze the obtained clustering and increase the density-threshold only for a portion of the data set. Since this could become quite involved, though, we will not follow that route here and concentrate instead on the semi-automatic and automatic alternatives further below.</p>
</section>
<section id="Semi-automatic-hierarchical-clustering">
<h2>Semi-automatic hierarchical clustering<a class="headerlink" href="#Semi-automatic-hierarchical-clustering" title="Link to this heading">¶</a></h2>
<p>We described rationally guided, manual hierarchical clustering in the <a class="reference internal" href="hierarchical_clustering_basics.html"><span class="doc">Hierarchical clustering basics</span></a> tutorial using the <code class="docutils literal notranslate"><span class="pre">isolate</span></code> formalism. Here we want to take the different approach of generating a cluster hierarchy more or less automatically for a given cluster parameter range. We will use the radius of <span class="math notranslate nohighlight">\(r=1.5\)</span> from the last section and a grid of <span class="math notranslate nohighlight">\(n_\mathrm{c}\)</span> values to cluster subsequently with higher density-thresholds while we keep
track of the change in the cluster label assignments.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="n">neighbourhoods</span><span class="p">,</span> <span class="n">sort_order</span><span class="p">,</span> <span class="n">revert_order</span> <span class="o">=</span> <span class="n">recipes</span><span class="o">.</span><span class="n">sorted_neighbourhoods_from_coordinates</span><span class="p">(</span><span class="n">langerin</span><span class="o">.</span><span class="n">input_data</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">sort_by</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">)</span>
<span class="n">langerin_neighbourhoods</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">Clustering</span><span class="p">(</span>
    <span class="n">neighbourhoods</span><span class="p">,</span> <span class="n">recipe</span><span class="o">=</span><span class="s2">&quot;sorted_neighbourhoods&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>We will start at <span class="math notranslate nohighlight">\(n_\mathrm{c}=2\)</span> but we will also need to determine a reasonable endpoint. To check the deduction of an upper bound from the number-of-neioghbours plot in the last section, let’s have a look at a clustering with a very high density-threshold.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">langerin_neighbourhoods</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">radius_cutoff</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">similarity_cutoff</span><span class="o">=</span><span class="mi">950</span><span class="p">)</span>
<span class="n">langerin</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">langerin_neighbourhoods</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">revert_order</span><span class="p">]</span>
<span class="n">draw_evaluate</span><span class="p">(</span><span class="n">langerin</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
-----------------------------------------------------------------------------------------------
#points   r         nc        min       max       #clusters %largest  %noise    time
26528     1.500     950       None      None      4         0.314     0.430     00:00:3.710
-----------------------------------------------------------------------------------------------

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_md_example_48_1.png" src="../_images/tutorial_md_example_48_1.png" />
</div>
</div>
<p>At this point, the clustering seem to yield only clusters that are shrinking with even higher values for <span class="math notranslate nohighlight">\(n_\mathrm{c}\)</span>. To perform a semi-automatic hierarchical clustering, we can use the <code class="docutils literal notranslate"><span class="pre">HierarchicalFitter</span></code> class <code class="docutils literal notranslate"><span class="pre">HierarchicalFitterRepeat</span></code>. This type uses a fitter repeatedly to build a cluster hierarchy.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">langerin_neighbourhoods</span><span class="o">.</span><span class="n">_hierarchical_fitter</span> <span class="o">=</span> <span class="n">_fit</span><span class="o">.</span><span class="n">HierarchicalFitterRepeat</span><span class="p">(</span>
    <span class="n">langerin_neighbourhoods</span><span class="o">.</span><span class="n">fitter</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Make a range of c values with larger jumps towards the end</span>
<span class="n">c_range</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">108</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">c_range</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">c_range</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span> <span class="o">*</span> <span class="mf">1.05</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">c_range</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 42, 44, 46, 48, 50, 52, 54, 56, 58, 60, 63, 66, 69, 72, 75, 78, 81, 85, 89, 93, 97, 101, 106, 111, 116, 121, 127, 133, 139, 145, 152, 159, 166, 174, 182, 191, 200, 210, 220, 231, 242, 254, 266, 279, 292, 306, 321, 337, 353, 370, 388, 407, 427, 448, 470, 493, 517, 542, 569, 597, 626, 657, 689, 723, 759, 796, 835, 876, 919, 964]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">langerin_neighbourhoods</span><span class="o">.</span><span class="n">fit_hierarchical</span><span class="p">(</span>
    <span class="n">radius_cutoffs</span><span class="o">=</span><span class="n">r</span><span class="p">,</span>
    <span class="n">similarity_cutoffs</span><span class="o">=</span><span class="n">c_range</span><span class="p">,</span>
    <span class="n">member_cutoff</span><span class="o">=</span><span class="mi">10</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
<span class="ansi-green-fg">2025-04-11 11:46:54.557</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 0     (r = 1.5, c = 2)</span>
<span class="ansi-green-fg">2025-04-11 11:46:54.873</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 1     (r = 1.5, c = 3)</span>
<span class="ansi-green-fg">2025-04-11 11:46:55.188</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 2     (r = 1.5, c = 4)</span>
<span class="ansi-green-fg">2025-04-11 11:46:55.504</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 3     (r = 1.5, c = 5)</span>
<span class="ansi-green-fg">2025-04-11 11:46:55.824</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 4     (r = 1.5, c = 6)</span>
<span class="ansi-green-fg">2025-04-11 11:46:56.140</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 5     (r = 1.5, c = 7)</span>
<span class="ansi-green-fg">2025-04-11 11:46:56.460</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 6     (r = 1.5, c = 8)</span>
<span class="ansi-green-fg">2025-04-11 11:46:56.782</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 7     (r = 1.5, c = 9)</span>
<span class="ansi-green-fg">2025-04-11 11:46:57.102</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 8     (r = 1.5, c = 10)</span>
<span class="ansi-green-fg">2025-04-11 11:46:57.423</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 9     (r = 1.5, c = 11)</span>
<span class="ansi-green-fg">2025-04-11 11:46:57.745</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 10    (r = 1.5, c = 12)</span>
<span class="ansi-green-fg">2025-04-11 11:46:58.068</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 11    (r = 1.5, c = 13)</span>
<span class="ansi-green-fg">2025-04-11 11:46:58.395</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 12    (r = 1.5, c = 14)</span>
<span class="ansi-green-fg">2025-04-11 11:46:58.723</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 13    (r = 1.5, c = 15)</span>
<span class="ansi-green-fg">2025-04-11 11:46:59.049</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 14    (r = 1.5, c = 16)</span>
<span class="ansi-green-fg">2025-04-11 11:46:59.377</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 15    (r = 1.5, c = 17)</span>
<span class="ansi-green-fg">2025-04-11 11:46:59.709</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 16    (r = 1.5, c = 18)</span>
<span class="ansi-green-fg">2025-04-11 11:47:00.037</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 17    (r = 1.5, c = 19)</span>
<span class="ansi-green-fg">2025-04-11 11:47:00.367</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 18    (r = 1.5, c = 20)</span>
<span class="ansi-green-fg">2025-04-11 11:47:00.696</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 19    (r = 1.5, c = 21)</span>
<span class="ansi-green-fg">2025-04-11 11:47:01.026</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 20    (r = 1.5, c = 22)</span>
<span class="ansi-green-fg">2025-04-11 11:47:01.354</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 21    (r = 1.5, c = 23)</span>
<span class="ansi-green-fg">2025-04-11 11:47:01.683</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 22    (r = 1.5, c = 24)</span>
<span class="ansi-green-fg">2025-04-11 11:47:02.016</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 23    (r = 1.5, c = 25)</span>
<span class="ansi-green-fg">2025-04-11 11:47:02.349</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 24    (r = 1.5, c = 26)</span>
<span class="ansi-green-fg">2025-04-11 11:47:02.678</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 25    (r = 1.5, c = 27)</span>
<span class="ansi-green-fg">2025-04-11 11:47:03.010</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 26    (r = 1.5, c = 28)</span>
<span class="ansi-green-fg">2025-04-11 11:47:03.343</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 27    (r = 1.5, c = 29)</span>
<span class="ansi-green-fg">2025-04-11 11:47:03.677</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 28    (r = 1.5, c = 30)</span>
<span class="ansi-green-fg">2025-04-11 11:47:04.014</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 29    (r = 1.5, c = 31)</span>
<span class="ansi-green-fg">2025-04-11 11:47:04.350</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 30    (r = 1.5, c = 32)</span>
<span class="ansi-green-fg">2025-04-11 11:47:04.682</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 31    (r = 1.5, c = 33)</span>
<span class="ansi-green-fg">2025-04-11 11:47:05.016</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 32    (r = 1.5, c = 34)</span>
<span class="ansi-green-fg">2025-04-11 11:47:05.352</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 33    (r = 1.5, c = 35)</span>
<span class="ansi-green-fg">2025-04-11 11:47:05.690</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 34    (r = 1.5, c = 36)</span>
<span class="ansi-green-fg">2025-04-11 11:47:06.030</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 35    (r = 1.5, c = 37)</span>
<span class="ansi-green-fg">2025-04-11 11:47:06.372</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 36    (r = 1.5, c = 38)</span>
<span class="ansi-green-fg">2025-04-11 11:47:06.710</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 37    (r = 1.5, c = 39)</span>
<span class="ansi-green-fg">2025-04-11 11:47:07.051</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 38    (r = 1.5, c = 40)</span>
<span class="ansi-green-fg">2025-04-11 11:47:07.388</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 39    (r = 1.5, c = 42)</span>
<span class="ansi-green-fg">2025-04-11 11:47:07.919</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 40    (r = 1.5, c = 44)</span>
<span class="ansi-green-fg">2025-04-11 11:47:08.536</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 41    (r = 1.5, c = 46)</span>
<span class="ansi-green-fg">2025-04-11 11:47:09.074</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 42    (r = 1.5, c = 48)</span>
<span class="ansi-green-fg">2025-04-11 11:47:09.543</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 43    (r = 1.5, c = 50)</span>
<span class="ansi-green-fg">2025-04-11 11:47:10.020</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 44    (r = 1.5, c = 52)</span>
<span class="ansi-green-fg">2025-04-11 11:47:10.463</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 45    (r = 1.5, c = 54)</span>
<span class="ansi-green-fg">2025-04-11 11:47:10.864</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 46    (r = 1.5, c = 56)</span>
<span class="ansi-green-fg">2025-04-11 11:47:11.294</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 47    (r = 1.5, c = 58)</span>
<span class="ansi-green-fg">2025-04-11 11:47:11.645</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 48    (r = 1.5, c = 60)</span>
<span class="ansi-green-fg">2025-04-11 11:47:12.002</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 49    (r = 1.5, c = 63)</span>
<span class="ansi-green-fg">2025-04-11 11:47:12.356</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 50    (r = 1.5, c = 66)</span>
<span class="ansi-green-fg">2025-04-11 11:47:12.715</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 51    (r = 1.5, c = 69)</span>
<span class="ansi-green-fg">2025-04-11 11:47:13.077</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 52    (r = 1.5, c = 72)</span>
<span class="ansi-green-fg">2025-04-11 11:47:13.438</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 53    (r = 1.5, c = 75)</span>
<span class="ansi-green-fg">2025-04-11 11:47:13.804</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 54    (r = 1.5, c = 78)</span>
<span class="ansi-green-fg">2025-04-11 11:47:14.175</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 55    (r = 1.5, c = 81)</span>
<span class="ansi-green-fg">2025-04-11 11:47:14.547</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 56    (r = 1.5, c = 85)</span>
<span class="ansi-green-fg">2025-04-11 11:47:14.925</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 57    (r = 1.5, c = 89)</span>
<span class="ansi-green-fg">2025-04-11 11:47:15.306</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 58    (r = 1.5, c = 93)</span>
<span class="ansi-green-fg">2025-04-11 11:47:15.692</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 59    (r = 1.5, c = 97)</span>
<span class="ansi-green-fg">2025-04-11 11:47:16.084</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 60    (r = 1.5, c = 101)</span>
<span class="ansi-green-fg">2025-04-11 11:47:16.479</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 61    (r = 1.5, c = 106)</span>
<span class="ansi-green-fg">2025-04-11 11:47:16.876</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 62    (r = 1.5, c = 111)</span>
<span class="ansi-green-fg">2025-04-11 11:47:17.282</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 63    (r = 1.5, c = 116)</span>
<span class="ansi-green-fg">2025-04-11 11:47:17.696</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 64    (r = 1.5, c = 121)</span>
<span class="ansi-green-fg">2025-04-11 11:47:18.117</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 65    (r = 1.5, c = 127)</span>
<span class="ansi-green-fg">2025-04-11 11:47:18.544</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 66    (r = 1.5, c = 133)</span>
<span class="ansi-green-fg">2025-04-11 11:47:18.977</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 67    (r = 1.5, c = 139)</span>
<span class="ansi-green-fg">2025-04-11 11:47:19.419</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 68    (r = 1.5, c = 145)</span>
<span class="ansi-green-fg">2025-04-11 11:47:19.874</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 69    (r = 1.5, c = 152)</span>
<span class="ansi-green-fg">2025-04-11 11:47:20.342</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 70    (r = 1.5, c = 159)</span>
<span class="ansi-green-fg">2025-04-11 11:47:20.831</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 71    (r = 1.5, c = 166)</span>
<span class="ansi-green-fg">2025-04-11 11:47:21.332</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 72    (r = 1.5, c = 174)</span>
<span class="ansi-green-fg">2025-04-11 11:47:21.846</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 73    (r = 1.5, c = 182)</span>
<span class="ansi-green-fg">2025-04-11 11:47:22.378</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 74    (r = 1.5, c = 191)</span>
<span class="ansi-green-fg">2025-04-11 11:47:22.917</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 75    (r = 1.5, c = 200)</span>
<span class="ansi-green-fg">2025-04-11 11:47:23.486</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 76    (r = 1.5, c = 210)</span>
<span class="ansi-green-fg">2025-04-11 11:47:24.064</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 77    (r = 1.5, c = 220)</span>
<span class="ansi-green-fg">2025-04-11 11:47:24.662</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 78    (r = 1.5, c = 231)</span>
<span class="ansi-green-fg">2025-04-11 11:47:25.292</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 79    (r = 1.5, c = 242)</span>
<span class="ansi-green-fg">2025-04-11 11:47:25.933</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 80    (r = 1.5, c = 254)</span>
<span class="ansi-green-fg">2025-04-11 11:47:26.593</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 81    (r = 1.5, c = 266)</span>
<span class="ansi-green-fg">2025-04-11 11:47:27.279</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 82    (r = 1.5, c = 279)</span>
<span class="ansi-green-fg">2025-04-11 11:47:27.976</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 83    (r = 1.5, c = 292)</span>
<span class="ansi-green-fg">2025-04-11 11:47:28.718</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 84    (r = 1.5, c = 306)</span>
<span class="ansi-green-fg">2025-04-11 11:47:29.496</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 85    (r = 1.5, c = 321)</span>
<span class="ansi-green-fg">2025-04-11 11:47:30.328</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 86    (r = 1.5, c = 337)</span>
<span class="ansi-green-fg">2025-04-11 11:47:31.194</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 87    (r = 1.5, c = 353)</span>
<span class="ansi-green-fg">2025-04-11 11:47:32.110</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 88    (r = 1.5, c = 370)</span>
<span class="ansi-green-fg">2025-04-11 11:47:33.089</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 89    (r = 1.5, c = 388)</span>
<span class="ansi-green-fg">2025-04-11 11:47:34.116</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 90    (r = 1.5, c = 407)</span>
<span class="ansi-green-fg">2025-04-11 11:47:35.163</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 91    (r = 1.5, c = 427)</span>
<span class="ansi-green-fg">2025-04-11 11:47:36.268</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 92    (r = 1.5, c = 448)</span>
<span class="ansi-green-fg">2025-04-11 11:47:37.407</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 93    (r = 1.5, c = 470)</span>
<span class="ansi-green-fg">2025-04-11 11:47:38.582</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 94    (r = 1.5, c = 493)</span>
<span class="ansi-green-fg">2025-04-11 11:47:39.887</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 95    (r = 1.5, c = 517)</span>
<span class="ansi-green-fg">2025-04-11 11:47:41.256</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 96    (r = 1.5, c = 542)</span>
<span class="ansi-green-fg">2025-04-11 11:47:42.768</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 97    (r = 1.5, c = 569)</span>
<span class="ansi-green-fg">2025-04-11 11:47:44.457</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 98    (r = 1.5, c = 597)</span>
<span class="ansi-green-fg">2025-04-11 11:47:46.274</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 99    (r = 1.5, c = 626)</span>
<span class="ansi-green-fg">2025-04-11 11:47:48.271</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 100   (r = 1.5, c = 657)</span>
<span class="ansi-green-fg">2025-04-11 11:47:50.563</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 101   (r = 1.5, c = 689)</span>
<span class="ansi-green-fg">2025-04-11 11:47:52.891</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 102   (r = 1.5, c = 723)</span>
<span class="ansi-green-fg">2025-04-11 11:47:55.202</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 103   (r = 1.5, c = 759)</span>
<span class="ansi-green-fg">2025-04-11 11:47:57.685</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 104   (r = 1.5, c = 796)</span>
<span class="ansi-green-fg">2025-04-11 11:48:00.350</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 105   (r = 1.5, c = 835)</span>
<span class="ansi-green-fg">2025-04-11 11:48:03.124</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 106   (r = 1.5, c = 876)</span>
<span class="ansi-green-fg">2025-04-11 11:48:06.250</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 107   (r = 1.5, c = 919)</span>
<span class="ansi-green-fg">2025-04-11 11:48:09.602</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Running step 108   (r = 1.5, c = 964)</span>
</pre></div></div>
</div>
<p>The resulting hierarchy of clusterings can be visualised either as a tree or pie plot.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Cluster hierarchy as tree diagram</span>
<span class="c1">#     (hierarchy level increasing from top to bottom)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span>
        <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">2.5</span><span class="p">,</span>
        <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">langerin_neighbourhoods</span><span class="o">.</span><span class="n">tree</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="n">draw_props</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;node_size&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>
        <span class="s2">&quot;node_shape&quot;</span><span class="p">:</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span>
        <span class="s2">&quot;with_labels&quot;</span><span class="p">:</span> <span class="kc">False</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_md_example_54_0.png" src="../_images/tutorial_md_example_54_0.png" />
</div>
</div>
<p>These diagrams can be admittedly hard to overlook because we have many hierarchy levels (one for each <span class="math notranslate nohighlight">\(n_\mathrm{c}\)</span> grid point). To reduces the cluster hierarchy to only a relevant number of bundles, we can apply some sort of trimming. A trimming protocol can be anything that traverses the bundle hierarchy (starting with the root bundle) and decides which bundles to keep, based on the bundle’s properties. We provide currently four basic trimming protocols: <code class="docutils literal notranslate"><span class="pre">&quot;trivial&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;shrinking&quot;</span></code>,
<code class="docutils literal notranslate"><span class="pre">&quot;lonechild&quot;</span></code>, and <code class="docutils literal notranslate"><span class="pre">&quot;small&quot;</span></code>. These can be triggered via <code class="docutils literal notranslate"><span class="pre">Clustering.trim()</span></code> under optional setting of the <code class="docutils literal notranslate"><span class="pre">protocol</span></code> keyword argument. Instead of a string to refer to a provided protocol, it is also possible to pass a callable that receives a bundle as the first argument and arbitrary keyword arguments.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">&quot;trivial&quot;</span></code> protocol will remove the labels and all children on bundles that have all-zero cluster label assignments. The <code class="docutils literal notranslate"><span class="pre">&quot;shrinking&quot;</span></code> protocol removes the children on bundles that will never split again (only shrink). The <code class="docutils literal notranslate"><span class="pre">&quot;lonechild&quot;</span></code> protocol will replace a single child of a bundle with its grandchildren, and <code class="docutils literal notranslate"><span class="pre">&quot;small&quot;</span></code> removes bundles with less then <code class="docutils literal notranslate"><span class="pre">member_cutoff</span></code> members. Other protocols are conceivable and users are encouraged to implement their own.</p>
<p>Bundle processing is supported by the two generator functions <code class="docutils literal notranslate"><span class="pre">_bundle.bfs</span></code> and <code class="docutils literal notranslate"><span class="pre">_bundles.bfs_leafs</span></code> that allow to loop over bundles in a breadth-first-search fashion.</p>
<p>Let’s see what execution of the <code class="docutils literal notranslate"><span class="pre">&quot;trivial&quot;</span></code> protocol does to our tree. In fact, it is purely cosemetic in the present case because noise points are not used to create new bundles during the used hierarchical fitting.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">langerin_neighbourhoods</span><span class="p">[</span><span class="s1">&#39;1.1.12&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">labels</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">langerin_neighbourhoods</span><span class="p">[</span><span class="s1">&#39;1.1.12&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">children</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{}
</pre></div></div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Trim trivial nodes (has no effect here)</span>
<span class="n">langerin_neighbourhoods</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span><span class="n">langerin_neighbourhoods</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="s2">&quot;trivial&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Cluster hierarchy as tree diagram</span>
<span class="c1">#     (hierarchy level increasing from top to bottom)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span>
        <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">2.5</span><span class="p">,</span>
        <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">langerin_neighbourhoods</span><span class="o">.</span><span class="n">tree</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="n">draw_props</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;node_size&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>
        <span class="s2">&quot;node_shape&quot;</span><span class="p">:</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span>
        <span class="s2">&quot;with_labels&quot;</span><span class="p">:</span> <span class="kc">False</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_md_example_60_0.png" src="../_images/tutorial_md_example_60_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">langerin_neighbourhoods</span><span class="p">[</span><span class="s1">&#39;1.1.12&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">labels</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">langerin_neighbourhoods</span><span class="p">[</span><span class="s1">&#39;1.1.12&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">children</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{}
</pre></div></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">&quot;shrinking&quot;</span></code> protocol on the other hand has a major effect. Of all the bundles in the tree above, we will keep only those that emerge from an immediate split into sub-clusters. Bundles created as the sole child of a parent will be removed if there is no further split further down the line. Note that this will still keep lone children if there is an actual split downstream.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The &quot;shrinking&quot; protocol is the default</span>
<span class="n">langerin_neighbourhoods</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span><span class="n">langerin_neighbourhoods</span><span class="o">.</span><span class="n">root</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Cluster hierarchy as tree diagram</span>
<span class="c1">#     (hierarchy level increasing from top to bottom)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span>
        <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">2.5</span><span class="p">,</span>
        <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">langerin_neighbourhoods</span><span class="o">.</span><span class="n">tree</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="n">draw_props</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;node_size&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>
        <span class="s2">&quot;node_shape&quot;</span><span class="p">:</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span>
        <span class="s2">&quot;with_labels&quot;</span><span class="p">:</span> <span class="kc">False</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_md_example_65_0.png" src="../_images/tutorial_md_example_65_0.png" />
</div>
</div>
<p>Another simplification is achieved through the <code class="docutils literal notranslate"><span class="pre">&quot;lonechild&quot;</span></code> protocol that will remove all the intermediate sole bundles at hierarchy levels where a cluster is only shrinking.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Remove levels on which only one child appears</span>
<span class="n">langerin_neighbourhoods</span><span class="o">.</span><span class="n">trim</span><span class="p">(</span><span class="n">langerin_neighbourhoods</span><span class="o">.</span><span class="n">root</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="s2">&quot;lonechild&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Cluster hierarchy as tree diagram</span>
<span class="c1">#     (hierarchy level increasing from top to bottom)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span>
        <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">2.5</span><span class="p">,</span>
        <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">langerin_neighbourhoods</span><span class="o">.</span><span class="n">tree</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="n">draw_props</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;node_size&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>
        <span class="s2">&quot;node_shape&quot;</span><span class="p">:</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span>
        <span class="s2">&quot;with_labels&quot;</span><span class="p">:</span> <span class="kc">False</span>
    <span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_md_example_68_0.png" src="../_images/tutorial_md_example_68_0.png" />
</div>
</div>
<p>And we can finally put everything together and incorporate the child clusters into the root data set. Note that for this, the <code class="docutils literal notranslate"><span class="pre">&quot;shrinking&quot;</span></code> protocol would have been sufficient.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">langerin_neighbourhoods</span><span class="o">.</span><span class="n">reel</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>After this call, cluster labeling may not be contiguous and sorted by size, which we can fix easily, though.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[24]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">langerin_neighbourhoods</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">_labels</span><span class="o">.</span><span class="n">sort_by_size</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">langerin</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">langerin_neighbourhoods</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">revert_order</span><span class="p">]</span>
<span class="n">draw_evaluate</span><span class="p">(</span><span class="n">langerin</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_md_example_73_0.png" src="../_images/tutorial_md_example_73_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Cluster hierarchy as pie diagram</span>
<span class="c1">#     (hierarchy level increasing from the center outwards)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">langerin</span><span class="o">.</span><span class="n">pie</span><span class="p">(</span>
    <span class="n">pie_props</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;normalize&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">((</span><span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(-0.3, 0.3)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_md_example_74_1.png" src="../_images/tutorial_md_example_74_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[36]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Label Size&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;==========&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">l</span><span class="si">:</span><span class="s2">&gt;5</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">s</span><span class="si">:</span><span class="s2">&gt;4</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">langerin</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">_labels</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span><span class="o">.</span><span class="n">items</span><span class="p">())),</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Label Size
==========
    0 3661
    1 9344
    2 4210
    3 2774
    4 2528
    5 2029
    6  507
    7  322
    8  225
    9  207
   10  203
   11  123
   12  118
   13  113
   14   57
   15   46
   16   26
   17   16
   18   10
   19    9
</pre></div></div>
</div>
<p>For later re-use, we can remember the clustering parameters leading to the isolation of each cluster and save the cluster labels.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;md_example/langerin_labels.npy&quot;</span><span class="p">,</span> <span class="n">langerin</span><span class="o">.</span><span class="n">labels</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Label&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">,</span> <span class="s2">&quot;n&quot;</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;-&quot;</span> <span class="o">*</span> <span class="mi">20</span><span class="p">)</span>
<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">langerin_neighbourhoods</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">_labels</span><span class="o">.</span><span class="n">meta</span><span class="p">[</span><span class="s2">&quot;params&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="o">*</span><span class="n">v</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Label   r       n
--------------------
1       1.5     964
2       1.5     5
3       1.5     964
4       1.5     2
5       1.5     93
6       1.5     22
8       1.5     2
9       1.5     2
10      1.5     2
12      1.5     2
13      1.5     2
14      1.5     5
15      1.5     2
16      1.5     2
17      1.5     2
19      1.5     4
</pre></div></div>
</div>
</section>
<section id="Automatic-hierarchical-clustering">
<h2>Automatic hierarchical clustering<a class="headerlink" href="#Automatic-hierarchical-clustering" title="Link to this heading">¶</a></h2>
<p>Semi-automatic clustering as demonstrated in the last section works reasonably well in our example. The need to screen potentially a lot of parameter combinations, however, to build a hierarchy from threshold-based slices can be seen as fundamentally flawed. We also offer a more rigorous directly hierarchical clustering procedure as an alternative. This fully hiearchical clustering outperforms semi-automatic clustering in several aspects:</p>
<ul class="simple">
<li><p>We only need to specify a neighbour search radius <em>r</em></p></li>
<li><p>We can be sure that we won’t miss relevant threshold values, i.e.</p>
<ul>
<li><p>all splits will be seen in the hierarchy</p></li>
<li><p>clusters as obtained will have their maximum possible extend</p></li>
</ul>
</li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Select a fast clustering recipe</span>
<span class="n">r</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="n">neighbourhoods</span><span class="p">,</span> <span class="n">sort_order</span><span class="p">,</span> <span class="n">revert_order</span> <span class="o">=</span> <span class="n">recipes</span><span class="o">.</span><span class="n">sorted_neighbourhoods_from_coordinates</span><span class="p">(</span><span class="n">langerin</span><span class="o">.</span><span class="n">input_data</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">sort_by</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">)</span>
<span class="n">langerin_neighbourhoods</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">Clustering</span><span class="p">(</span>
    <span class="n">neighbourhoods</span><span class="p">,</span> <span class="n">recipe</span><span class="o">=</span><span class="s2">&quot;sorted_neighbourhoods_mst&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">langerin_neighbourhoods</span><span class="o">.</span><span class="n">fit_hierarchical</span><span class="p">(</span><span class="n">radius_cutoff</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">member_cutoff</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
<span class="ansi-green-fg">2025-04-11 12:00:29.918</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Started hierarchical CommonNN clustering - HierarchicalFitterExtCommonNNMSTPrim</span>
<span class="ansi-green-fg">2025-04-11 12:07:20.216</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">commonnn.report</span>:<span class="ansi-cyan-fg">wrapper</span>:<span class="ansi-cyan-fg">248</span> - <span class="ansi-bold">Built MST</span>
<span class="ansi-green-fg">2025-04-11 12:07:20.275</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Computed Scipy Z matrix</span>
<span class="ansi-green-fg">2025-04-11 12:07:21.435</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Built bundle hierarchy from Scipy Z matrix</span>
<span class="ansi-green-fg">2025-04-11 12:07:21.445</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Converted all leafs to root labels</span>
</pre></div></div>
</div>
<p>The present implementation is still experimental. It currently includes by default the construction of a Scipy compatible Z-matrix, which represents a binary tree of bottom-up merges of data points or clusters at decreasing density thresholds:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Cluster a, cluster b, density threshold, member count</span>
<span class="n">langerin_neighbourhoods</span><span class="o">.</span><span class="n">_hierarchical_fitter</span><span class="o">.</span><span class="n">_artifacts</span><span class="p">[</span><span class="s2">&quot;Z&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([[0.0000e+00, 3.0000e+00, 5.3240e+03, 2.0000e+00],
       [2.0000e+00, 5.0000e+00, 5.2230e+03, 2.0000e+00],
       [1.4000e+01, 2.6529e+04, 5.1540e+03, 3.0000e+00],
       ...,
       [2.6483e+04, 5.3051e+04, 0.0000e+00, 2.6526e+04],
       [2.6482e+04, 5.3052e+04, 0.0000e+00, 2.6527e+04],
       [2.6481e+04, 5.3053e+04, 0.0000e+00, 2.6528e+04]])
</pre></div></div>
</div>
<p>From this, a hierarchy of <code class="docutils literal notranslate"><span class="pre">Bundle</span></code> instances is created in a second step. Here we already apply a <code class="docutils literal notranslate"><span class="pre">member_cutoff</span></code> to decide when a split results in two relevant clusters or just represents the shrinking of a parent cluster. In this step, lone child nodes will be already removed as well. Furthermore we resolve binary structure of the tree so that a parent can have more than two children if they arise from a split at the same density threshold. So to some extend, this includes a processing of
the hierarchy as shown for the semi-automatic case already. Both the Scipy and bundle hierarchy building step can be suppressed with <code class="docutils literal notranslate"><span class="pre">scipy_hierarchy=False</span></code> and <code class="docutils literal notranslate"><span class="pre">bundle_hierarchy=False</span></code>.</p>
<p>It should be noted that for technical reasons the bundles do not carry labels yet, but collect their members in a <code class="docutils literal notranslate"><span class="pre">bundle.graph</span></code> object (currenly just a Python <code class="docutils literal notranslate"><span class="pre">set</span></code>). If <code class="docutils literal notranslate"><span class="pre">make_labels=True</span></code> (default) the leaf nodes of the bundle hierarchy will be used to set labels on the root bundle, though, in the end.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[44]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">langerin</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">langerin_neighbourhoods</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">revert_order</span><span class="p">]</span>
<span class="n">langerin</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">_labels</span><span class="o">.</span><span class="n">sort_by_size</span><span class="p">()</span>
<span class="n">draw_evaluate</span><span class="p">(</span><span class="n">langerin</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_md_example_86_0.png" src="../_images/tutorial_md_example_86_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[51]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span>
        <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">2.5</span><span class="p">,</span>
        <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">langerin_neighbourhoods</span><span class="o">.</span><span class="n">tree</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="n">draw_props</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;node_size&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>
        <span class="s2">&quot;node_shape&quot;</span><span class="p">:</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span>
        <span class="s2">&quot;with_labels&quot;</span><span class="p">:</span> <span class="kc">False</span>
    <span class="p">},</span>
    <span class="n">annotate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">annotate_format</span><span class="o">=</span><span class="s2">&quot;λ=</span><span class="si">{lambda}</span><span class="s2">&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_md_example_87_0.png" src="../_images/tutorial_md_example_87_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[45]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Label Size&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;==========&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">l</span><span class="si">:</span><span class="s2">&gt;5</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">s</span><span class="si">:</span><span class="s2">&gt;4</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">langerin</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">_labels</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span><span class="o">.</span><span class="n">items</span><span class="p">())),</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Label Size
==========
    0 5715
    1 7606
    2 4210
    3 2795
    4 2532
    5 2049
    6  523
    7  228
    8  214
    9  208
   10  119
   11  114
   12   57
   13   53
   14   48
   15   29
   16   18
   17   10
</pre></div></div>
</div>
<p>The clustering result is largely equivalent to what we obtained in the semi-automatic run before with the difference that this time the clusters are not taken from arbitrary slices of the hierarchy. A semi-automatic clustering would need to use an increment of 1 in <span class="math notranslate nohighlight">\(n_\mathrm{c}\)</span> over the full parameter range to reach the same accuracy. We can also note that the current hierarchy yields an additional split far down at <span class="math notranslate nohighlight">\(n_\mathrm{c}=1098\)</span>, a value that we did not include in the
semi-automatic parameter range. Before this background, it seems acceptable that the fully hierarchical clustering is by a factor of 5 times slower in this direct comparison (6:51 vs. 1:20 minutes).</p>
<p>Let’s finish here with a another look at the choice of the neighbourhood radius <em>r</em>. Since the fully hierarchical approach allows us to play with this parameter without worrying about changing similarity threshold values, it is easy to compare full hierarchies side by side. At smaller radii, the clustering can become orders of maginitude faster. Ideally, the end result is not very sensisitive to the actual choice of <em>r</em> at all. At smaller and smaller radii, however, we may cross over from having
a representative local density estimate that resolves all density differences nicely to a noisy estimate that creates artifical splits. Below we see additional clusters emerging for a lower radius. Whether this still makes sense, has to be validated in context.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[56]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Select a fast clustering recipe</span>
<span class="n">r</span> <span class="o">=</span> <span class="mf">1.2</span>
<span class="n">neighbourhoods</span><span class="p">,</span> <span class="n">sort_order</span><span class="p">,</span> <span class="n">revert_order</span> <span class="o">=</span> <span class="n">recipes</span><span class="o">.</span><span class="n">sorted_neighbourhoods_from_coordinates</span><span class="p">(</span><span class="n">langerin</span><span class="o">.</span><span class="n">input_data</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">sort_by</span><span class="o">=</span><span class="s2">&quot;both&quot;</span><span class="p">)</span>
<span class="n">langerin_neighbourhoods</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">Clustering</span><span class="p">(</span>
    <span class="n">neighbourhoods</span><span class="p">,</span> <span class="n">recipe</span><span class="o">=</span><span class="s2">&quot;sorted_neighbourhoods_mst&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[57]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">langerin_neighbourhoods</span><span class="o">.</span><span class="n">fit_hierarchical</span><span class="p">(</span><span class="n">radius_cutoff</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">member_cutoff</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
<span class="ansi-green-fg">2025-04-11 12:54:40.331</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Started hierarchical CommonNN clustering - HierarchicalFitterExtCommonNNMSTPrim</span>
<span class="ansi-green-fg">2025-04-11 12:56:03.711</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">commonnn.report</span>:<span class="ansi-cyan-fg">wrapper</span>:<span class="ansi-cyan-fg">248</span> - <span class="ansi-bold">Built MST</span>
<span class="ansi-green-fg">2025-04-11 12:56:03.764</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Computed Scipy Z matrix</span>
<span class="ansi-green-fg">2025-04-11 12:56:05.021</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Built bundle hierarchy from Scipy Z matrix</span>
<span class="ansi-green-fg">2025-04-11 12:56:05.029</span> | <span class="ansi-bold">INFO    </span> | <span class="ansi-cyan-fg">__main__</span>:<span class="ansi-cyan-fg">&lt;module&gt;</span>:<span class="ansi-cyan-fg">1</span> - <span class="ansi-bold">Converted all leafs to root labels</span>
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[58]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">langerin</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">langerin_neighbourhoods</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">revert_order</span><span class="p">]</span>
<span class="n">langerin</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">_labels</span><span class="o">.</span><span class="n">sort_by_size</span><span class="p">()</span>
<span class="n">draw_evaluate</span><span class="p">(</span><span class="n">langerin</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_md_example_93_0.png" src="../_images/tutorial_md_example_93_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[59]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span>
        <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mf">2.5</span><span class="p">,</span>
        <span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s2">&quot;figure.figsize&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">langerin_neighbourhoods</span><span class="o">.</span><span class="n">tree</span><span class="p">(</span>
    <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="n">draw_props</span><span class="o">=</span><span class="p">{</span>
        <span class="s2">&quot;node_size&quot;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span>
        <span class="s2">&quot;node_shape&quot;</span><span class="p">:</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span>
        <span class="s2">&quot;with_labels&quot;</span><span class="p">:</span> <span class="kc">False</span>
    <span class="p">},</span>
    <span class="n">annotate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">annotate_format</span><span class="o">=</span><span class="s2">&quot;λ=</span><span class="si">{lambda}</span><span class="s2">&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_md_example_95_0.png" src="../_images/tutorial_md_example_95_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[60]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Label Size&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;==========&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">l</span><span class="si">:</span><span class="s2">&gt;5</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">s</span><span class="si">:</span><span class="s2">&gt;4</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">({</span><span class="n">k</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">langerin</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">_labels</span><span class="o">.</span><span class="n">mapping</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span><span class="o">.</span><span class="n">items</span><span class="p">())),</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Label Size
==========
    0 10596
    1 4644
    2 3238
    3 2851
    4 2522
    5  707
    6  384
    7  294
    8  225
    9  188
   10  185
   11  162
   12  119
   13   87
   14   57
   15   46
   16   40
   17   37
   18   26
   19   24
   20   17
   21   13
   22   13
   23   12
   24   11
   25   10
   26   10
   27   10
</pre></div></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">CommonNN Clustering</a></h1>



<p class="blurb">A Python package for common-nearest-neighbour clustering</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=bkellerlab&repo=CommonNNClustering&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../_source/install.html">Installation instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_source/quickstart.html">Quickstart</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../_source/tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="basic_usage.html">Basic usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="scikit_learn_datasets.html">Clustering of scikit-learn toy data sets</a></li>
<li class="toctree-l2"><a class="reference internal" href="scikit_learn_datasets_hierarchical.html">Clustering of scikit-learn toy data sets (hierarchically)</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced_usage.html">Advanced usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="interface_demo.html">Demonstration of (generic) interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="hierarchical_clustering_basics.html">Hierarchical clustering basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="algorithm_explained.html">Density-based clustering basics</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Molecular dynamics application example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../_source/api_reference.html">API Reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../_source/tutorials.html">Tutorials</a><ul>
      <li>Previous: <a href="algorithm_explained.html" title="previous chapter">Density-based clustering basics</a></li>
      <li>Next: <a href="../_source/api_reference.html" title="next chapter">API Reference</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2022, Jan-Oliver Kapp-Joswig.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.4.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../_sources/tutorial/md_example.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>