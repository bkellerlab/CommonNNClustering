
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Clustering of scikit-learn toy data sets &#8212; CommonNN Clustering  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Advanced usage" href="advanced_usage.html" />
    <link rel="prev" title="Basic usage" href="basic_usage.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<style>
    .nbinput .prompt,
    .nboutput .prompt {
        display: none;
    }
</style><section id="Clustering-of-scikit-learn-toy-data-sets">
<h1>Clustering of scikit-learn toy data sets<a class="headerlink" href="#Clustering-of-scikit-learn-toy-data-sets" title="Permalink to this heading">¶</a></h1>
<p>Go to:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#Notebook-configuration"><span class="std std-ref">Notebook configuration</span></a></p></li>
<li><p><a class="reference internal" href="#Data-set-generation"><span class="std std-ref">Data set generation</span></a></p></li>
<li><p>CommonNN clustering using …</p>
<ul>
<li><p><a class="reference internal" href="#CommonNN-clustering-using-data-point-coordinates-as-input"><span class="std std-ref">… point coordinates</span></a></p></li>
<li><p><a class="reference internal" href="#CommonNN-clustering-with-pre-computed-distances"><span class="std std-ref">… pre-computed distances</span></a></p></li>
<li><p><a class="reference internal" href="#CommonNN-clustering-with-pre-computed-neighbourhoods"><span class="std std-ref">… pre-computed neighbourhoods</span></a></p></li>
<li><p><a class="reference internal" href="#CommonNN-clustering-with-pre-computed-neighbourhoods-(sorted-by-member-index)"><span class="std std-ref">… pre-computed sorted neighbourhoods</span></a></p></li>
<li><p><a class="reference internal" href="#CommonNN-clustering-with-pre-computed-neighbourhoods-(sorted-by-member-index-and-neighbour-count)"><span class="std std-ref">… pre-computed doubly sorted neighbourhoods</span></a></p></li>
</ul>
</li>
</ul>
<section id="Notebook-configuration">
<h2>Notebook configuration<a class="headerlink" href="#Notebook-configuration" title="Permalink to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">sklearn</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="n">datasets</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">pairwise_distances</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KDTree</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>

<span class="kn">import</span> <span class="nn">commonnn</span>
<span class="kn">from</span> <span class="nn">commonnn</span> <span class="kn">import</span> <span class="n">cluster</span>
<span class="kn">from</span> <span class="nn">commonnn</span> <span class="kn">import</span> <span class="n">_types</span><span class="p">,</span> <span class="n">_fit</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Helper function definitions</span>
<span class="k">def</span> <span class="nf">indent_at_parens</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Take a string and introduce indention at parentheses&quot;&quot;&quot;</span>

    <span class="n">o</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">level</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">saw_comma</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">s</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">saw_comma</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot; &quot;</span><span class="p">:</span>
                <span class="n">o</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;    &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">level</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">o</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;    &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">level</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="si">}{</span><span class="n">c</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">saw_comma</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;(&quot;</span><span class="p">:</span>
            <span class="n">o</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;(</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;    &#39;</span> <span class="o">*</span> <span class="n">level</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">level</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;)&quot;</span><span class="p">:</span>
            <span class="n">level</span> <span class="o">-=</span> <span class="mi">1</span>
            <span class="n">o</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">{</span><span class="s1">&#39;    &#39;</span> <span class="o">*</span> <span class="n">level</span><span class="si">}</span><span class="s2">)&quot;</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">c</span> <span class="o">==</span> <span class="s2">&quot;,&quot;</span><span class="p">:</span>
            <span class="n">saw_comma</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">o</span> <span class="o">+=</span> <span class="s2">&quot;,&quot;</span>
            <span class="k">continue</span>

        <span class="n">o</span> <span class="o">+=</span> <span class="n">c</span>

    <span class="k">return</span> <span class="n">o</span>
</pre></div>
</div>
</div>
<p>Print Python and package version information:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Version information</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Python: &quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Packages:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">package</span> <span class="ow">in</span> <span class="p">[</span><span class="n">mpl</span><span class="p">,</span> <span class="n">np</span><span class="p">,</span> <span class="n">sklearn</span><span class="p">,</span> <span class="n">commonnn</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">package</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">package</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Python:  3.10.7 (main, Sep 27 2022, 11:41:38) [GCC 10.2.1 20210110]
Packages:
    matplotlib: 3.6.0
    numpy: 1.23.3
    sklearn: 1.1.2
    commonnn: 0.0.1
</pre></div></div>
</div>
<p>We use <a class="reference external" href="https://matplotlib.org/">Matplotlib</a> to create plots. The <code class="docutils literal notranslate"><span class="pre">matplotlibrc</span></code> file in the root directory of the <code class="docutils literal notranslate"><span class="pre">CommonNNClustering</span></code> repository is used to customize the appearance of the plots.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Matplotlib configuration</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rc_file</span><span class="p">(</span>
    <span class="s2">&quot;../../matplotlibrc&quot;</span><span class="p">,</span>
    <span class="n">use_default_template</span><span class="o">=</span><span class="kc">False</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Axis property defaults for the plots</span>
<span class="n">ax_props</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;xlabel&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s2">&quot;ylabel&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
    <span class="s2">&quot;xlim&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">),</span>
    <span class="s2">&quot;ylim&quot;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">),</span>
    <span class="s2">&quot;xticks&quot;</span><span class="p">:</span> <span class="p">(),</span>
    <span class="s2">&quot;yticks&quot;</span><span class="p">:</span> <span class="p">(),</span>
    <span class="s2">&quot;aspect&quot;</span><span class="p">:</span> <span class="s2">&quot;equal&quot;</span>
<span class="p">}</span>

<span class="c1"># Line plot property defaults</span>
<span class="n">line_props</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;linewidth&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
    <span class="s2">&quot;marker&quot;</span><span class="p">:</span> <span class="s1">&#39;.&#39;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</section>
<section id="Data-set-generation">
<h2>Data set generation<a class="headerlink" href="#Data-set-generation" title="Permalink to this heading">¶</a></h2>
<p>To see the common-nearest-neighbours (CommonNN) clustering in action, let’s have a look at a handful of basic 2D data sets from scikit-learn (like here in the <a class="reference external" href="https://scikit-learn.org/stable/auto_examples/cluster/plot_cluster_comparison.html">scikit-learn documentation</a>). We will cluster the data sets starting from different input data formats using the provided defaults. For more details see also the <a class="reference internal" href="advanced_usage.html"><span class="doc">Advanced usage</span></a> tutorial.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Data set generation parameters</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">n_samples</span> <span class="o">=</span> <span class="mi">2000</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Data set generation</span>
<span class="c1"># Fit all datasets to the same value range</span>
<span class="c1">#    using `data = StandardScaler().fit_transform(data)`</span>

<span class="c1"># circles</span>
<span class="n">noisy_circles</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">make_circles</span><span class="p">(</span>
    <span class="n">n_samples</span><span class="o">=</span><span class="n">n_samples</span><span class="p">,</span>
    <span class="n">factor</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span>
    <span class="n">noise</span><span class="o">=</span><span class="mf">.05</span>
    <span class="p">)</span>
<span class="n">noisy_circles</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">noisy_circles</span><span class="p">)</span>

<span class="c1"># moons</span>
<span class="n">noisy_moons</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">make_moons</span><span class="p">(</span>
    <span class="n">n_samples</span><span class="o">=</span><span class="n">n_samples</span><span class="p">,</span>
    <span class="n">noise</span><span class="o">=</span><span class="mf">.05</span>
    <span class="p">)</span>
<span class="n">noisy_moons</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">noisy_moons</span><span class="p">)</span>

<span class="c1"># blobs</span>
<span class="n">blobs</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">make_blobs</span><span class="p">(</span>
    <span class="n">n_samples</span><span class="o">=</span><span class="n">n_samples</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="mi">8</span>
    <span class="p">)</span>
<span class="n">blobs</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">blobs</span><span class="p">)</span>

<span class="c1"># None</span>
<span class="n">no_structure</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span>
    <span class="n">n_samples</span><span class="p">,</span> <span class="mi">2</span>
    <span class="p">)</span>
<span class="n">no_structure</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">no_structure</span><span class="p">)</span>

<span class="c1"># aniso</span>
<span class="n">random_state</span> <span class="o">=</span> <span class="mi">170</span>
<span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">make_blobs</span><span class="p">(</span>
    <span class="n">n_samples</span><span class="o">=</span><span class="n">n_samples</span><span class="p">,</span>
    <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span>
    <span class="p">)</span>

<span class="n">transformation</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.6</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.6</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">]]</span>
<span class="n">aniso</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">transformation</span><span class="p">)</span>
<span class="n">aniso</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">aniso</span><span class="p">)</span>

<span class="c1"># varied</span>
<span class="n">varied</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">datasets</span><span class="o">.</span><span class="n">make_blobs</span><span class="p">(</span>
    <span class="n">n_samples</span><span class="o">=</span><span class="n">n_samples</span><span class="p">,</span>
    <span class="n">cluster_std</span><span class="o">=</span><span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">],</span>
    <span class="n">random_state</span><span class="o">=</span><span class="n">random_state</span>
    <span class="p">)</span>
<span class="n">varied</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">varied</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define cluster parameters</span>
<span class="n">dsets</span> <span class="o">=</span> <span class="p">[</span> <span class="c1"># &quot;name&quot;, set, **parameters</span>
    <span class="p">(</span><span class="s1">&#39;circles&#39;</span><span class="p">,</span> <span class="n">noisy_circles</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">&#39;radius_cutoff&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="s1">&#39;similarity_cutoff&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
        <span class="s1">&#39;member_cutoff&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
        <span class="s1">&#39;max_clusters&#39;</span><span class="p">:</span> <span class="kc">None</span>
        <span class="p">}),</span>
    <span class="p">(</span><span class="s1">&#39;moons&#39;</span><span class="p">,</span> <span class="n">noisy_moons</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">&#39;radius_cutoff&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="s1">&#39;similarity_cutoff&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
        <span class="s1">&#39;member_cutoff&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s1">&#39;max_clusters&#39;</span><span class="p">:</span> <span class="kc">None</span>
        <span class="p">}),</span>
    <span class="p">(</span><span class="s1">&#39;varied&#39;</span><span class="p">,</span> <span class="n">varied</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">&#39;radius_cutoff&#39;</span><span class="p">:</span> <span class="mf">0.28</span><span class="p">,</span>
        <span class="s1">&#39;similarity_cutoff&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
        <span class="s1">&#39;member_cutoff&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
        <span class="s1">&#39;max_clusters&#39;</span><span class="p">:</span> <span class="kc">None</span>
        <span class="p">}),</span>
    <span class="p">(</span><span class="s1">&#39;aniso&#39;</span><span class="p">,</span> <span class="n">aniso</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">&#39;radius_cutoff&#39;</span><span class="p">:</span> <span class="mf">0.29</span><span class="p">,</span>
        <span class="s1">&#39;similarity_cutoff&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
        <span class="s1">&#39;member_cutoff&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
        <span class="s1">&#39;max_clusters&#39;</span><span class="p">:</span> <span class="kc">None</span>
         <span class="p">}),</span>
    <span class="p">(</span><span class="s1">&#39;blobs&#39;</span><span class="p">,</span> <span class="n">blobs</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">&#39;radius_cutoff&#39;</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">,</span>
        <span class="s1">&#39;similarity_cutoff&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
        <span class="s1">&#39;member_cutoff&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
        <span class="s1">&#39;max_clusters&#39;</span><span class="p">:</span> <span class="kc">None</span>
        <span class="p">}),</span>
    <span class="p">(</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">no_structure</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">&#39;radius_cutoff&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>
        <span class="s1">&#39;similarity_cutoff&#39;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span>
        <span class="s1">&#39;member_cutoff&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
        <span class="s1">&#39;max_clusters&#39;</span><span class="p">:</span> <span class="kc">None</span>
        <span class="p">}),</span>
    <span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the original data sets</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">Ax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dsets</span><span class="p">):</span>
    <span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">line_props</span><span class="p">)</span>
    <span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">ax_props</span><span class="p">)</span>
    <span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span>
    <span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.3</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_scikit_learn_datasets_15_0.png" src="../_images/tutorial_scikit_learn_datasets_15_0.png" />
</div>
</div>
</section>
<section id="CommonNN-clustering-using-data-point-coordinates-as-input">
<h2>CommonNN clustering using data point coordinates as input<a class="headerlink" href="#CommonNN-clustering-using-data-point-coordinates-as-input" title="Permalink to this heading">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">Ax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dsets</span><span class="p">):</span>

    <span class="c1"># Default clustering initialisation</span>
    <span class="n">clustering</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">Clustering</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># Calculate neighbours brute force</span>
    <span class="n">clustering</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>

    <span class="n">clustering</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">],</span> <span class="n">annotate_pos</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">)</span>
    <span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">ax_props</span><span class="p">)</span>
    <span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span>
    <span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.3</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
-----------------------------------------------------------------------------------------------
#points   r         nc        min       max       #clusters %largest  %noise    time
2000      0.500     20        100       None      2         0.500     0.000     00:00:0.119
-----------------------------------------------------------------------------------------------


-----------------------------------------------------------------------------------------------
#points   r         nc        min       max       #clusters %largest  %noise    time
2000      0.500     20        2         None      2         0.500     0.000     00:00:0.134
-----------------------------------------------------------------------------------------------


-----------------------------------------------------------------------------------------------
#points   r         nc        min       max       #clusters %largest  %noise    time
2000      0.280     20        20        None      3         0.338     0.114     00:00:0.176
-----------------------------------------------------------------------------------------------


-----------------------------------------------------------------------------------------------
#points   r         nc        min       max       #clusters %largest  %noise    time
2000      0.290     30        5         None      3         0.319     0.050     00:00:0.136
-----------------------------------------------------------------------------------------------


-----------------------------------------------------------------------------------------------
#points   r         nc        min       max       #clusters %largest  %noise    time
2000      0.400     20        2         None      3         0.334     0.001     00:00:0.239
-----------------------------------------------------------------------------------------------


-----------------------------------------------------------------------------------------------
#points   r         nc        min       max       #clusters %largest  %noise    time
2000      0.500     20        1         None      1         1.000     0.000     00:00:0.115
-----------------------------------------------------------------------------------------------


</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_scikit_learn_datasets_17_1.png" src="../_images/tutorial_scikit_learn_datasets_17_1.png" />
</div>
</div>
<p>When <em>raw</em> input data is presented to a <code class="docutils literal notranslate"><span class="pre">Clustering</span></code> on creation without specifying anything else, the obtained <code class="docutils literal notranslate"><span class="pre">Clustering</span></code> object aggregates the needed clustering components, assuming that it got point coordinates as a sequence of sequences. The neighbourhood of a specific point will be collected brute-force by computing the (Euclidean) distances to all other points and comparing them to the radius cutoff. This will be the slowest possible approach but it has fairly conservative memory
usage.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Clustering components used by default (&quot;coordinates&quot; recipe)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">indent_at_parens</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">clustering</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Clustering(
    input_data=InputDataExtComponentsMemoryview(
        components of 2000 points in 2 dimensions
        ),
    fitter=FitterExtCommonNNBFS(
        ngetter=NeighboursGetterExtBruteForce(
            dgetter=DistanceGetterExtMetric(
                metric=MetricExtEuclideanReduced
                ),
            sorted=False,
            selfcounting=True
            ),
        na=NeighboursExtVectorUnorderedSet,
        nb=NeighboursExtVectorUnorderedSet,
        checker=SimilarityCheckerExtSwitchContains,
        queue=QueueExtFIFOQueue
        ),
    hierarchical_fitter=None,
    predictor=None
    )
</pre></div></div>
</div>
</section>
<section id="CommonNN-clustering-with-pre-computed-distances">
<h2>CommonNN clustering with pre-computed distances<a class="headerlink" href="#CommonNN-clustering-with-pre-computed-distances" title="Permalink to this heading">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">Ax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dsets</span><span class="p">):</span>

    <span class="c1"># Default clustering initialisation</span>
    <span class="n">clustering</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">Clustering</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># Pre-compute distances and choose the corresponding recipe</span>
    <span class="n">distances</span> <span class="o">=</span> <span class="n">pairwise_distances</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">clustering_dist</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">Clustering</span><span class="p">(</span>
        <span class="n">distances</span><span class="p">,</span>
        <span class="n">recipe</span><span class="o">=</span><span class="s2">&quot;distances&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Use pre-computed distances</span>
    <span class="n">clustering_dist</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
    <span class="n">clustering</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">clustering_dist</span><span class="o">.</span><span class="n">labels</span>
    <span class="nb">print</span><span class="p">()</span>

    <span class="n">clustering</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">],</span> <span class="n">annotate_pos</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">)</span>
    <span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">ax_props</span><span class="p">)</span>
    <span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span>
    <span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.3</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
-----------------------------------------------------------------------------------------------
#points   r         nc        min       max       #clusters %largest  %noise    time
2000      0.500     20        100       None      2         0.500     0.000     00:00:0.069
-----------------------------------------------------------------------------------------------


-----------------------------------------------------------------------------------------------
#points   r         nc        min       max       #clusters %largest  %noise    time
2000      0.500     20        2         None      2         0.500     0.000     00:00:0.084
-----------------------------------------------------------------------------------------------


-----------------------------------------------------------------------------------------------
#points   r         nc        min       max       #clusters %largest  %noise    time
2000      0.280     20        20        None      3         0.338     0.114     00:00:0.106
-----------------------------------------------------------------------------------------------


-----------------------------------------------------------------------------------------------
#points   r         nc        min       max       #clusters %largest  %noise    time
2000      0.290     30        5         None      3         0.319     0.050     00:00:0.079
-----------------------------------------------------------------------------------------------


-----------------------------------------------------------------------------------------------
#points   r         nc        min       max       #clusters %largest  %noise    time
2000      0.400     20        2         None      3         0.334     0.001     00:00:0.183
-----------------------------------------------------------------------------------------------


-----------------------------------------------------------------------------------------------
#points   r         nc        min       max       #clusters %largest  %noise    time
2000      0.500     20        1         None      1         1.000     0.000     00:00:0.066
-----------------------------------------------------------------------------------------------


</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_scikit_learn_datasets_21_1.png" src="../_images/tutorial_scikit_learn_datasets_21_1.png" />
</div>
</div>
<p>When <em>raw</em> input data is presented to a <code class="docutils literal notranslate"><span class="pre">Clustering</span></code> on creation in terms of a dense distance matrix, the “distances” recipe can be chosen to make the obtained <code class="docutils literal notranslate"><span class="pre">Clustering</span></code> object aggregate the needed clustering components. The neighbourhood of a specific point will be collected brute-force by looking up distances from the input data. This will be somewhat faster as no distances need to be calculated during the clustering but it has a high memory demand. It also allows to leverage smart
external methods for the task of the distance calculation.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Clustering components used by the &quot;distance&quot; recipe</span>
<span class="nb">print</span><span class="p">(</span><span class="n">indent_at_parens</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">clustering_dist</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Clustering(
    input_data=InputDataExtComponentsMemoryview(
        components of 2000 points in 2000 dimensions
        ),
    fitter=FitterExtCommonNNBFS(
        ngetter=NeighboursGetterExtBruteForce(
            dgetter=DistanceGetterExtMetric(
                metric=MetricExtPrecomputed
                ),
            sorted=False,
            selfcounting=True
            ),
        na=NeighboursExtVectorUnorderedSet,
        nb=NeighboursExtVectorUnorderedSet,
        checker=SimilarityCheckerExtSwitchContains,
        queue=QueueExtFIFOQueue
        ),
    hierarchical_fitter=None,
    predictor=None
    )
</pre></div></div>
</div>
</section>
<section id="CommonNN-clustering-with-pre-computed-neighbourhoods">
<h2>CommonNN clustering with pre-computed neighbourhoods<a class="headerlink" href="#CommonNN-clustering-with-pre-computed-neighbourhoods" title="Permalink to this heading">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">Ax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dsets</span><span class="p">):</span>

    <span class="n">clustering</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">Clustering</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># Pre-compute neighbourhoods and choose the corresponding recipe</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">KDTree</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">neighbourhoods</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">query_radius</span><span class="p">(</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;radius_cutoff&quot;</span><span class="p">],</span> <span class="n">return_distance</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

    <span class="n">clustering_neighbourhoods</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">Clustering</span><span class="p">(</span>
        <span class="n">neighbourhoods</span><span class="p">,</span>
        <span class="n">recipe</span><span class="o">=</span><span class="s2">&quot;neighbourhoods&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Use pre-computed neighbourhoods</span>
    <span class="n">clustering_neighbourhoods</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
    <span class="n">clustering</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">clustering_neighbourhoods</span><span class="o">.</span><span class="n">labels</span>
    <span class="nb">print</span><span class="p">()</span>

    <span class="n">clustering</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">],</span> <span class="n">annotate_pos</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">)</span>
    <span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">ax_props</span><span class="p">)</span>
    <span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span>
    <span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.3</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
-----------------------------------------------------------------------------------------------
#points   r         nc        min       max       #clusters %largest  %noise    time
2000      0.500     20        100       None      2         0.500     0.000     00:00:0.033
-----------------------------------------------------------------------------------------------


-----------------------------------------------------------------------------------------------
#points   r         nc        min       max       #clusters %largest  %noise    time
2000      0.500     20        2         None      2         0.500     0.000     00:00:0.046
-----------------------------------------------------------------------------------------------


-----------------------------------------------------------------------------------------------
#points   r         nc        min       max       #clusters %largest  %noise    time
2000      0.280     20        20        None      3         0.338     0.114     00:00:0.056
-----------------------------------------------------------------------------------------------


-----------------------------------------------------------------------------------------------
#points   r         nc        min       max       #clusters %largest  %noise    time
2000      0.290     30        5         None      3         0.319     0.050     00:00:0.038
-----------------------------------------------------------------------------------------------


-----------------------------------------------------------------------------------------------
#points   r         nc        min       max       #clusters %largest  %noise    time
2000      0.400     20        2         None      3         0.334     0.001     00:00:0.133
-----------------------------------------------------------------------------------------------


-----------------------------------------------------------------------------------------------
#points   r         nc        min       max       #clusters %largest  %noise    time
2000      0.500     20        1         None      1         1.000     0.000     00:00:0.030
-----------------------------------------------------------------------------------------------


</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_scikit_learn_datasets_25_1.png" src="../_images/tutorial_scikit_learn_datasets_25_1.png" />
</div>
</div>
<p>When <em>raw</em> input data is presented to a <code class="docutils literal notranslate"><span class="pre">Clustering</span></code> on creation in terms of pre-computed neighbourhoods, the “neighbourhoods” recipe can be chosen to make the obtained <code class="docutils literal notranslate"><span class="pre">Clustering</span></code> object aggregate the needed clustering components. The neighbourhood of a specific point will looked up from the input data. This will be considerably faster and it has a lower memory demand compared to the “distances” case. It also allows to leverage smart external methods for the task of the neighbourhood
calculation.</p>
<p>Note, that the “neighbourhoods” recipe requires the <em>raw</em> neighbourhoods in the concrete format of a matrix in which the neighbourhoods of individual points are padded to the length of the largest neighbourhood. If neighbourhoods are presented in terms of a sequence of sequences (with varying length) as one would get from a tree query to <code class="docutils literal notranslate"><span class="pre">sklearn.neighbors.KDTree</span></code>, this can be transformed into the suitable format using the preparation hook <code class="docutils literal notranslate"><span class="pre">hooks.prepare_neighbourhoods</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Clustering components used by the &quot;distance&quot; recipe</span>
<span class="nb">print</span><span class="p">(</span><span class="n">indent_at_parens</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">clustering_neighbourhoods</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Clustering(
    input_data=InputDataExtNeighbourhoodsMemoryview(
        neighbourhoods of 2000 points
        ),
    fitter=FitterExtCommonNNBFS(
        ngetter=NeighboursGetterExtLookup(
            sorted=False,
            selfcounting=True
            ),
        na=NeighboursExtVectorUnorderedSet,
        nb=NeighboursExtVectorUnorderedSet,
        checker=SimilarityCheckerExtSwitchContains,
        queue=QueueExtFIFOQueue
        ),
    hierarchical_fitter=None,
    predictor=None
    )
</pre></div></div>
</div>
</section>
<section id="CommonNN-clustering-with-pre-computed-neighbourhoods-(sorted-by-member-index)">
<h2>CommonNN clustering with pre-computed neighbourhoods (sorted by member index)<a class="headerlink" href="#CommonNN-clustering-with-pre-computed-neighbourhoods-(sorted-by-member-index)" title="Permalink to this heading">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">Ax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dsets</span><span class="p">):</span>

    <span class="n">clustering</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">Clustering</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># Pre-compute and sort neighbourhoods and choose the corresponding recipe</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">KDTree</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">neighbourhoods</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">query_radius</span><span class="p">(</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;radius_cutoff&quot;</span><span class="p">],</span> <span class="n">return_distance</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">neighbourhoods</span><span class="p">:</span>
        <span class="n">n</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

    <span class="c1"># Custom initialisation using a clustering builder</span>
    <span class="n">clustering_neighbourhoods_sorted</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">Clustering</span><span class="p">(</span>
        <span class="n">neighbourhoods</span><span class="p">,</span>
        <span class="n">recipe</span><span class="o">=</span><span class="s2">&quot;sorted_neighbourhoods&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Use pre-computed neighbourhoods</span>
    <span class="n">clustering_neighbourhoods_sorted</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
    <span class="n">clustering</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">clustering_neighbourhoods_sorted</span><span class="o">.</span><span class="n">labels</span>
    <span class="nb">print</span><span class="p">()</span>

    <span class="n">clustering</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">],</span> <span class="n">annotate_pos</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">)</span>
    <span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">ax_props</span><span class="p">)</span>
    <span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span>
    <span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.3</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
-----------------------------------------------------------------------------------------------
#points   r         nc        min       max       #clusters %largest  %noise    time
2000      0.500     20        100       None      2         0.500     0.000     00:00:0.003
-----------------------------------------------------------------------------------------------


-----------------------------------------------------------------------------------------------
#points   r         nc        min       max       #clusters %largest  %noise    time
2000      0.500     20        2         None      2         0.500     0.000     00:00:0.004
-----------------------------------------------------------------------------------------------


-----------------------------------------------------------------------------------------------
#points   r         nc        min       max       #clusters %largest  %noise    time
2000      0.280     20        20        None      3         0.338     0.114     00:00:0.006
-----------------------------------------------------------------------------------------------


-----------------------------------------------------------------------------------------------
#points   r         nc        min       max       #clusters %largest  %noise    time
2000      0.290     30        5         None      3         0.319     0.050     00:00:0.004
-----------------------------------------------------------------------------------------------


-----------------------------------------------------------------------------------------------
#points   r         nc        min       max       #clusters %largest  %noise    time
2000      0.400     20        2         None      3         0.334     0.001     00:00:0.011
-----------------------------------------------------------------------------------------------


-----------------------------------------------------------------------------------------------
#points   r         nc        min       max       #clusters %largest  %noise    time
2000      0.500     20        1         None      1         1.000     0.000     00:00:0.004
-----------------------------------------------------------------------------------------------


</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_scikit_learn_datasets_29_1.png" src="../_images/tutorial_scikit_learn_datasets_29_1.png" />
</div>
</div>
<p>Pre-computed neighbourhood information can be additionally sorted in terms of the indices of the members (i.e. so that within each neighbourhood the members are stored in increasing order of there index in the data set). While this has the same memory demand as using unsorted neighbourhoods, it offers the fastest clustering.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Clustering components used by the &quot;distance&quot; recipe</span>
<span class="nb">print</span><span class="p">(</span><span class="n">indent_at_parens</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">clustering_neighbourhoods_sorted</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Clustering(
    input_data=InputDataExtNeighbourhoodsMemoryview(
        neighbourhoods of 2000 points
        ),
    fitter=FitterExtCommonNNBFS(
        ngetter=NeighboursGetterExtLookup(
            sorted=True,
            selfcounting=True
            ),
        na=NeighboursExtVector,
        nb=NeighboursExtVector,
        checker=SimilarityCheckerExtScreensorted,
        queue=QueueExtFIFOQueue
        ),
    hierarchical_fitter=None,
    predictor=None
    )
</pre></div></div>
</div>
</section>
<section id="CommonNN-clustering-with-pre-computed-neighbourhoods-(sorted-by-member-index-and-neighbour-count)">
<h2>CommonNN clustering with pre-computed neighbourhoods (sorted by member index and neighbour count)<a class="headerlink" href="#CommonNN-clustering-with-pre-computed-neighbourhoods-(sorted-by-member-index-and-neighbour-count)" title="Permalink to this heading">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">Ax</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="k">for</span> <span class="n">count</span><span class="p">,</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">dsets</span><span class="p">):</span>

    <span class="n">clustering</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">Clustering</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># Pre-compute and sort neighbourhoods and choose the corresponding recipe</span>
    <span class="n">tree</span> <span class="o">=</span> <span class="n">KDTree</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">neighbourhoods</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">query_radius</span><span class="p">(</span>
        <span class="n">data</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;radius_cutoff&quot;</span><span class="p">],</span> <span class="n">return_distance</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>

    <span class="n">n_members</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
        <span class="n">n</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">neighbourhoods</span>
    <span class="p">])</span>
    <span class="n">sorted_by_member_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">n_members</span><span class="p">)</span>
    <span class="n">revert_sort</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">sorted_by_member_count</span><span class="p">)</span>



    <span class="n">neighbourhoods</span> <span class="o">=</span> <span class="n">neighbourhoods</span><span class="p">[</span><span class="n">sorted_by_member_count</span><span class="p">]</span>
    <span class="n">neighbourhoods</span> <span class="o">=</span> <span class="p">[</span><span class="n">revert_sort</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">neighbourhoods</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">neighbourhoods</span><span class="p">:</span>
        <span class="n">n</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

    <span class="c1"># Custom initialisation using a clustering builder</span>
    <span class="n">clustering_neighbourhoods_sorted</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">Clustering</span><span class="p">(</span>
        <span class="n">neighbourhoods</span><span class="p">,</span>
        <span class="n">recipe</span><span class="o">=</span><span class="s2">&quot;sorted_neighbourhoods&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Use pre-computed neighbourhoods</span>
    <span class="n">clustering_neighbourhoods_sorted</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="o">**</span><span class="n">params</span><span class="p">)</span>
    <span class="n">clustering</span><span class="o">.</span><span class="n">labels</span> <span class="o">=</span> <span class="n">clustering_neighbourhoods_sorted</span><span class="o">.</span><span class="n">labels</span><span class="p">[</span><span class="n">revert_sort</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">()</span>

    <span class="n">clustering</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">],</span> <span class="n">annotate_pos</span><span class="o">=</span><span class="s2">&quot;random&quot;</span><span class="p">)</span>
    <span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">**</span><span class="n">ax_props</span><span class="p">)</span>
    <span class="n">Ax</span><span class="p">[</span><span class="n">count</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span>
    <span class="n">left</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.3</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
-----------------------------------------------------------------------------------------------
#points   r         nc        min       max       #clusters %largest  %noise    time
2000      0.500     20        100       None      2         0.500     0.000     00:00:0.003
-----------------------------------------------------------------------------------------------


-----------------------------------------------------------------------------------------------
#points   r         nc        min       max       #clusters %largest  %noise    time
2000      0.500     20        2         None      2         0.500     0.000     00:00:0.005
-----------------------------------------------------------------------------------------------


-----------------------------------------------------------------------------------------------
#points   r         nc        min       max       #clusters %largest  %noise    time
2000      0.280     20        20        None      3         0.338     0.114     00:00:0.006
-----------------------------------------------------------------------------------------------


-----------------------------------------------------------------------------------------------
#points   r         nc        min       max       #clusters %largest  %noise    time
2000      0.290     30        5         None      3         0.319     0.050     00:00:0.004
-----------------------------------------------------------------------------------------------


-----------------------------------------------------------------------------------------------
#points   r         nc        min       max       #clusters %largest  %noise    time
2000      0.400     20        2         None      3         0.334     0.001     00:00:0.011
-----------------------------------------------------------------------------------------------


-----------------------------------------------------------------------------------------------
#points   r         nc        min       max       #clusters %largest  %noise    time
2000      0.500     20        1         None      1         1.000     0.000     00:00:0.003
-----------------------------------------------------------------------------------------------


</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorial_scikit_learn_datasets_33_1.png" src="../_images/tutorial_scikit_learn_datasets_33_1.png" />
</div>
</div>
<p>As a further addition to the sorting of each neighbourhood by member indices, it is possible to sort all neighbourhoods according to their member count (i.e. so that the point with the highest neighbour count becomes the first point in the data set). It is not guaranteed but this additional sorting can make the clustering even more efficient.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Clustering components used by the &quot;distance&quot; recipe</span>
<span class="nb">print</span><span class="p">(</span><span class="n">indent_at_parens</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">clustering_neighbourhoods_sorted</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Clustering(
    input_data=InputDataExtNeighbourhoodsMemoryview(
        neighbourhoods of 2000 points
        ),
    fitter=FitterExtCommonNNBFS(
        ngetter=NeighboursGetterExtLookup(
            sorted=True,
            selfcounting=True
            ),
        na=NeighboursExtVector,
        nb=NeighboursExtVector,
        checker=SimilarityCheckerExtScreensorted,
        queue=QueueExtFIFOQueue
        ),
    hierarchical_fitter=None,
    predictor=None
    )
</pre></div></div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">CommonNN Clustering</a></h1>



<p class="blurb">A Python package for common-nearest-neighbour clustering</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=bkellerlab&repo=CommonNNClustering&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../_source/install.html">Installation instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_source/quickstart.html">Quickstart</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../_source/tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="basic_usage.html">Basic usage</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Clustering of scikit-learn toy data sets</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced_usage.html">Advanced usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="interface_demo.html">Demonstration of (generic) interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="hierarchical_clustering_basics.html">Hierarchical clustering basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="algorithm_explained.html">Density-based clustering basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="md_example.html">Molecular dynamics application example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../_source/api_reference.html">API Reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../_source/tutorials.html">Tutorials</a><ul>
      <li>Previous: <a href="basic_usage.html" title="previous chapter">Basic usage</a></li>
      <li>Next: <a href="advanced_usage.html" title="next chapter">Advanced usage</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Jan-Oliver Kapp-Joswig.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.2.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/tutorial/scikit_learn_datasets.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>