<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Advanced usage &#8212; CommonNN Clustering  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a5519fdd" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=77a3bc79" />
    <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=d18eccf6" />
    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Demonstration of (generic) interfaces" href="interface_demo.html" />
    <link rel="prev" title="Clustering of scikit-learn toy data sets" href="scikit_learn_datasets.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <style>
    .nbinput .prompt,
    .nboutput .prompt {
        display: none;
    }
</style><section id="Advanced-usage">
<h1>Advanced usage<a class="headerlink" href="#Advanced-usage" title="Link to this heading">¶</a></h1>
<p>Go to:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#Notebook-configuration"><span class="std std-ref">Notebook configuration</span></a></p></li>
<li><p><a class="reference internal" href="#Clustering-initialisation"><span class="std std-ref">Clustering initialisation</span></a></p>
<ul>
<li><p><a class="reference internal" href="#Short-initialisation-for-point-coordinates"><span class="std std-ref">Short initialisation</span></a></p></li>
<li><p><a class="reference internal" href="#Manual-custom-initialisation"><span class="std std-ref">Manual custom initialisation</span></a></p></li>
<li><p><a class="reference internal" href="#Initialisation-via-a-builder"><span class="std std-ref">Initialisation via a builder</span></a></p></li>
</ul>
</li>
</ul>
<section id="Notebook-configuration">
<h2>Notebook configuration<a class="headerlink" href="#Notebook-configuration" title="Link to this heading">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">commonnn</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">commonnn</span><span class="w"> </span><span class="kn">import</span> <span class="n">cluster</span><span class="p">,</span> <span class="n">recipes</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">commonnn</span><span class="w"> </span><span class="kn">import</span> <span class="n">_bundle</span><span class="p">,</span> <span class="n">_types</span><span class="p">,</span> <span class="n">_fit</span>
</pre></div>
</div>
</div>
<p>Print Python and package version information:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Version information</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Python: &quot;</span><span class="p">,</span> <span class="o">*</span><span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Packages:&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">package</span> <span class="ow">in</span> <span class="p">[</span><span class="n">np</span><span class="p">,</span> <span class="n">commonnn</span><span class="p">]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">package</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">package</span><span class="o">.</span><span class="n">__version__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Python:  3.10.7 (main, Sep 27 2022, 11:41:38) [GCC 10.2.1 20210110]
Packages:
    numpy: 1.23.3
    commonnn: 0.0.1
</pre></div></div>
</div>
</section>
<section id="Clustering-initialisation">
<h2>Clustering initialisation<a class="headerlink" href="#Clustering-initialisation" title="Link to this heading">¶</a></h2>
<section id="Short-initialisation-for-point-coordinates">
<h3>Short initialisation for point coordinates<a class="headerlink" href="#Short-initialisation-for-point-coordinates" title="Link to this heading">¶</a></h3>
<p>In the <a class="reference internal" href="basic_usage.html"><span class="doc">Basic usage</span></a> tutorial, we saw how to create a <code class="docutils literal notranslate"><span class="pre">Clustering</span></code> object from a list of point coordinates.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Three dummy points in three dimensions</span>
<span class="n">points</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="p">]</span>
<span class="n">clustering</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">Clustering</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The created <code class="docutils literal notranslate"><span class="pre">Clustering</span></code> object is now ready to execute a clustering on the provided input data. In fact, this default initialisation works in the same way with any Python sequence of sequences.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Ten random points in four dimensions</span>
<span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">clustering</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">Clustering</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Please note, that this does only yield meaningful results if the input data does indeed contain point coordinates. When a <code class="docutils literal notranslate"><span class="pre">Clustering</span></code> is initialised like this, quite a few steps are carried out in the background to ensure the correct assembly of the object. To be specific, the following things are taken care of:</p>
<ul class="simple">
<li><p>The <em>raw</em> input data (here <code class="docutils literal notranslate"><span class="pre">points</span></code>) is wrapped into a generic input data object (a concrete implementation of the abstract class <code class="docutils literal notranslate"><span class="pre">_types.InputData</span></code>)</p>
<ul>
<li><p>Prior to the wrapping, the raw data may be passed through a preparation function that returns it in a format matching the input data type</p></li>
</ul>
</li>
<li><p>A generic fitter object (a concrete implementation of the abstract class <code class="docutils literal notranslate"><span class="pre">_fit.Fitter</span></code>) is selected and associated with the clustering</p>
<ul>
<li><p>The fitter is equipped with other necessary building blocks</p></li>
</ul>
</li>
</ul>
<p>In consequence, the created <code class="docutils literal notranslate"><span class="pre">Clustering</span></code> object carries a set of other objects that control how a clustering of the input data is executed. Which objects that are is controlled by a recipe (defined in the <code class="docutils literal notranslate"><span class="pre">recipes</span></code> module. The default registered recipe is named <code class="docutils literal notranslate"><span class="pre">&quot;coordinates&quot;</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">clustering</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Clustering(input_data=InputDataExtComponentsMemoryview(components of 10 points in 4 dimensions), fitter=FitterExtCommonNNBFS(ngetter=NeighboursGetterExtBruteForce(dgetter=DistanceGetterExtMetric(metric=MetricExtEuclideanReduced), sorted=False, selfcounting=True), na=NeighboursExtVectorUnorderedSet, nb=NeighboursExtVectorUnorderedSet, checker=SimilarityCheckerExtSwitchContains, queue=QueueExtFIFOQueue), hierarchical_fitter=None, predictor=None)
</pre></div></div>
</div>
<p>To understand the setup steps and the different kinds of partaking objects better, lets have a closer look at the default recipe for the <code class="docutils literal notranslate"><span class="pre">Clustering</span></code> class in the next section.</p>
</section>
<section id="Manual-custom-initialisation">
<h3>Manual custom initialisation<a class="headerlink" href="#Manual-custom-initialisation" title="Link to this heading">¶</a></h3>
<p>There are multiple ways to initialise a <code class="docutils literal notranslate"><span class="pre">Clustering</span></code>:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">help</span><span class="p">(</span><span class="n">cluster</span><span class="o">.</span><span class="n">Clustering</span><span class="o">.</span><span class="fm">__init__</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Help on cython_function_or_method in module commonnn.cluster:

__init__(self, data=None, *, fitter=None, hierarchical_fitter=None, predictor=None, bundle_kwargs=None, recipe=None, **recipe_kwargs)
    Clustering.__init__(self, data=None, *, fitter=None, hierarchical_fitter=None, predictor=None, bundle_kwargs=None, recipe=None, **recipe_kwargs)

    Keyword args:
        data:
            The data points to be clustered. Can be one of
                * `None`:
                    Plain initialisation without input data.
                * A :class:`~commonnn._bundle.Bundle`:
                    Initialisation with a ready-made input data bundle.
                * Any object implementing the input data interface
                (see :class:`~commonnn._types.InputData` or
                :class:`~commonnn._types.InputDataExtInterface`):
                    in this case, additional keyword arguments can be passed
                    via `bundle_kwargs` which are used to initialise a
                    :class:`~commonnn._bundle.Bundle` from the input data,
                    e.g. `labels`, `children`, etc.
                * Raw input data: Takes the input data type and a preparation
                hook from the `recipe` and wraps the raw data.
        fitter:
            Executes the clustering procedure. Can be
                * Any object implementing the fitter interface (see :class:`~commonnn._fit.Fitter` or
                :class:`~commonnn._fit.FitterExtInterface`).
                * None:
                    In this case, the fitter is tried to be build from the `recipe` or left
                    as `None`.
        hierarchical_fitter:
            Like `fitter` but for hierarchical clustering (see
            :class:`~commonnn._fit.HierarchicalFitter` or
            :class:`~commonnn._fit.HierarchicalFitterExtInterface`).
        predictor:
            Translates a clustering result from one bundle to another. Treated like
            `fitter` (see
            :class:`~commonnn._fit.Predictor` or
            :class:`~commonnn._fit.PredictorExtInterface`).
        bundle_kwargs: Used to create a :class:`~commonnn._bundle.Bundle`
            if `data` is neither a bundle nor `None`.
        recipe:
            Used to assemble a fitter etc. and to wrap raw input data. Can be
                * A string corresponding to a registered default recipe (see
                    :obj:`~commonnn.recipes.REGISTERED_RECIPES`
                )
                * A recipe, i.e. a mapping of component keywords to component types
        **recipe_kwargs: Passed on to override entries in the base `recipe`. Use double
            underscores in key names instead of dots, e.g. fitter__na instead of fitter.na.

</pre></div></div>
</div>
<p>If, like in the example above, raw data is passed on initialisation without the specification of other options, certain assumptions are made and the clustering object is created using a default recipe. For illustration, lets create a clustering object without data and by explicitly silencing the default recipe. This will give us a plain clustering object without any other building blocks attached.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plain_clustering</span> <span class="o">=</span> <span class="n">cluster</span><span class="o">.</span><span class="n">Clustering</span><span class="p">(</span><span class="n">recipe</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">plain_clustering</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Clustering(input_data=None, fitter=None, hierarchical_fitter=None, predictor=None)
</pre></div></div>
</div>
<p>Naturally, this object is not set up for the actual clustering.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plain_clustering</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">radius_cutoff</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">similarity_cutoff</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-intense-fg ansi-bold">---------------------------------------------------------------------------</span>
<span class="ansi-red-intense-fg ansi-bold">AttributeError</span>                            Traceback (most recent call last)
Cell <span class="ansi-green-intense-fg ansi-bold">In [8], line 1</span>
<span class="ansi-green-intense-fg ansi-bold">----&gt; 1</span> plain_clustering<span style="color: rgb(98,98,98)">.</span>fit(radius_cutoff<span style="color: rgb(98,98,98)">=</span><span style="color: rgb(98,98,98)">0.1</span>, similarity_cutoff<span style="color: rgb(98,98,98)">=</span><span style="color: rgb(98,98,98)">2</span>)

File <span class="ansi-green-intense-fg ansi-bold">src/commonnn/cluster.pyx:283</span>, in <span class="ansi-cyan-fg">commonnn.cluster.Clustering.fit</span><span class="ansi-blue-intense-fg ansi-bold">()</span>

<span class="ansi-red-intense-fg ansi-bold">AttributeError</span>: &#39;NoneType&#39; object has no attribute &#39;fit&#39;
</pre></div></div>
</div>
<p>Starting from scratch, we need to provide some input data and associate it with the clustering.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
    <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
<span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>To do so, we first need to associate these data with a <code class="docutils literal notranslate"><span class="pre">Bundle</span></code>. A bundle in turn is added to the <code class="docutils literal notranslate"><span class="pre">Clustering</span></code>. Bundles will become important in the context of hierarchical clustering. Trying to create a bundle with our <em>raw</em> input data, however, will result in in error.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">_bundle</span><span class="o">.</span><span class="n">Bundle</span><span class="p">(</span><span class="n">input_data</span><span class="o">=</span><span class="n">points</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-intense-fg ansi-bold">---------------------------------------------------------------------------</span>
<span class="ansi-red-intense-fg ansi-bold">TypeError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-intense-fg ansi-bold">In [10], line 1</span>
<span class="ansi-green-intense-fg ansi-bold">----&gt; 1</span> _bundle<span style="color: rgb(98,98,98)">.</span>Bundle(input_data<span style="color: rgb(98,98,98)">=</span>points)

File <span class="ansi-green-intense-fg ansi-bold">src/commonnn/_bundle.pyx:30</span>, in <span class="ansi-cyan-fg">commonnn._bundle.Bundle.__cinit__</span><span class="ansi-blue-intense-fg ansi-bold">()</span>

File <span class="ansi-green-intense-fg ansi-bold">src/commonnn/_bundle.pyx:59</span>, in <span class="ansi-cyan-fg">commonnn._bundle.Bundle.input_data.__set__</span><span class="ansi-blue-intense-fg ansi-bold">()</span>

<span class="ansi-red-intense-fg ansi-bold">TypeError</span>: Can&#39;t use object of type ndarray as input data. Expected type InputData.
</pre></div></div>
</div>
<p>Input data needs to be provided in terms of a generic type to allow a clustering procedure to be executed with it. Generic types can be accessed and worked with in a universal fashion, independent of how data is actually physically stored. A good type to be created from raw data points presented as a NumPy array is <code class="docutils literal notranslate"><span class="pre">_types.InputDataExtComponentsMemoryview</span></code>:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">input_data</span> <span class="o">=</span> <span class="n">_types</span><span class="o">.</span><span class="n">InputDataExtComponentsMemoryview</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
<span class="n">bundle</span> <span class="o">=</span> <span class="n">_bundle</span><span class="o">.</span><span class="n">Bundle</span><span class="p">(</span><span class="n">input_data</span><span class="o">=</span><span class="n">input_data</span><span class="p">)</span>
<span class="n">plain_clustering</span><span class="o">.</span><span class="n">_bundle</span> <span class="o">=</span> <span class="n">bundle</span>
</pre></div>
</div>
</div>
<p>Note that this type requires a C-continuous 2-dimensional array of 64-bit floats. Python nested sequences can be converted into this format using <code class="docutils literal notranslate"><span class="pre">recipes.prepare_components_array_from_parts</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">plain_clustering</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Clustering(input_data=InputDataExtComponentsMemoryview(components of 3 points in 3 dimensions), fitter=None, hierarchical_fitter=None, predictor=None)
</pre></div></div>
</div>
<div class="admonition note">
<p><strong>Info:</strong> If you know what you are doing, you can still associate arbitrary input data to a clustering (bundle) by assigning to <code class="docutils literal notranslate"><span class="pre">Bundle._input_data</span></code> directly.</p>
</div>
<p>But we are not done yet and clustering is still not possible because we are missing a fitter that controls how the clustering should be actually done.</p>
<p>The default fitter for any common-nearest-neighbours clustering is <code class="docutils literal notranslate"><span class="pre">_fit.FitterExtCommonNNBFS</span></code>. If we want to initialise this fitter, we additionally need to provide the following building blocks that we need to pass as the following arguments:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">neighbours_getter</span></code>: A generic object that defines how neighbourhood information can be retrieved from the input data object. Needs to be a concrete implementation of the abstract class <code class="docutils literal notranslate"><span class="pre">_types.NeighboursGetter</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">neighbours</span></code>: A generic object to hold the retrieved neighbourhood of one point. Filled by the <code class="docutils literal notranslate"><span class="pre">neighbours_getter</span></code>. Needs to be a concrete implementation of the abstract class <code class="docutils literal notranslate"><span class="pre">_types.Neighbours</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">neighbour_neighbours</span></code>: As <code class="docutils literal notranslate"><span class="pre">neighbours</span></code>. The <code class="docutils literal notranslate"><span class="pre">FitterExtCommonNNBFS</span></code> fitter uses exactly two containers to store the neighbourhoods of two points.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">similarity_checker</span></code>: A generic object that controls how the common-nearest-neighbour similarity criterion (at least <em>c</em> common neighbours) is checked. Needs to be a concrete implementation of the abstract class <code class="docutils literal notranslate"><span class="pre">_types.SimilarityChecker</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">queue</span></code>: A generic queuing structure needed for the breadth-first-search approach implemented by the fitter. Needs to be a concrete implementation of the abstract class <code class="docutils literal notranslate"><span class="pre">_types.Queue</span></code>.</p></li>
</ul>
<p>So let’s create these building blocks to prepare a fitter for the clustering. Note, that the by default recommended neighbours getter (<code class="docutils literal notranslate"><span class="pre">_types.NeighboursGetterExtBruteForce</span></code>) does in turn require a distance getter (that controls how pairwise distances for points in the input data are retrieved), which again expects us to define a metric. For the neighbours containers we choose a type that wraps a C++ vector. The similarity check will be done by a set of containment checks and the queuing
structure will be a C++ queue.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Choose Euclidean metric</span>
<span class="n">metric</span> <span class="o">=</span> <span class="n">_types</span><span class="o">.</span><span class="n">MetricExtEuclidean</span><span class="p">()</span>
<span class="n">distance_getter</span> <span class="o">=</span> <span class="n">_types</span><span class="o">.</span><span class="n">DistanceGetterExtMetric</span><span class="p">(</span><span class="n">metric</span><span class="p">)</span>

<span class="c1"># Make neighbours getter</span>
<span class="n">neighbours_getter</span> <span class="o">=</span> <span class="n">_types</span><span class="o">.</span><span class="n">NeighboursGetterExtBruteForce</span><span class="p">(</span><span class="n">distance_getter</span><span class="p">)</span>

<span class="c1"># Make fitter</span>
<span class="n">fitter</span> <span class="o">=</span> <span class="n">_fit</span><span class="o">.</span><span class="n">FitterExtCommonNNBFS</span><span class="p">(</span>
    <span class="n">neighbours_getter</span><span class="p">,</span>
    <span class="n">_types</span><span class="o">.</span><span class="n">NeighboursExtVector</span><span class="p">(),</span>
    <span class="n">_types</span><span class="o">.</span><span class="n">NeighboursExtVector</span><span class="p">(),</span>
    <span class="n">_types</span><span class="o">.</span><span class="n">SimilarityCheckerExtContains</span><span class="p">(),</span>
    <span class="n">_types</span><span class="o">.</span><span class="n">QueueExtFIFOQueue</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>This fitter can now be associated with our clustering. With everything in place, a clustering can be finally executed.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plain_clustering</span><span class="o">.</span><span class="n">fitter</span> <span class="o">=</span> <span class="n">fitter</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plain_clustering</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">radius_cutoff</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">similarity_cutoff</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
-----------------------------------------------------------------------------------------------
#points   r         nc        min       max       #clusters %largest  %noise    time
3         0.100     2         None      None      0         0.000     1.000     00:00:0.000
-----------------------------------------------------------------------------------------------

</pre></div></div>
</div>
<p>The described manual way to initialise a <code class="docutils literal notranslate"><span class="pre">Clustering</span></code> instance is very flexible as the user can cherry pick exactly the desired types to modify the different contributing pieces. On the other hand, this approach can be fairly tedious and error prone. In the next section we will see how we solved this problem by facilitating the aggregation of a clustering according to pre-defined schemes.</p>
</section>
<section id="Initialisation-via-a-builder">
<h3>Initialisation via a builder<a class="headerlink" href="#Initialisation-via-a-builder" title="Link to this heading">¶</a></h3>
<p>We did see so far how to assemble a <code class="docutils literal notranslate"><span class="pre">Clustering</span></code> instance from scratch by selecting the individual clustering components manually. In the beginning we did also see that we could create a <code class="docutils literal notranslate"><span class="pre">Clustering</span></code> seemingly automatically if we just pass <em>raw</em> data to the constructor. To fill the gap, let’s now have a look at how a <code class="docutils literal notranslate"><span class="pre">Clustering</span></code> can be created via a <code class="docutils literal notranslate"><span class="pre">Builder</span></code>. A builder is a helper object that serves the purpose of correctly creating a <code class="docutils literal notranslate"><span class="pre">Clustering</span></code> based on some preset requirements, a
so called <em>recipe</em>. When we try to initialise a <code class="docutils literal notranslate"><span class="pre">Clustering</span></code> with <em>raw</em> input data (that is not wrapped in a valid generic input data type), a <code class="docutils literal notranslate"><span class="pre">recipes.Builder</span></code> instance actually tries to take over behind the scenes. By default, a builder is associated with a certain recipe.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">builder</span> <span class="o">=</span> <span class="n">recipes</span><span class="o">.</span><span class="n">Builder</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">builder</span><span class="o">.</span><span class="n">default_recipe</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
coordinates
</pre></div></div>
</div>
<p>We should look into what is actually meant by a clustering recipe. A recipe is basically a nested mapping of clustering component strings (matching the corresponding keyword arguments used on clustering/component initialisation, e.g. <code class="docutils literal notranslate"><span class="pre">&quot;input_data&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;neighbours&quot;</span></code>) to the generic types (classes not instances) that should be used in the corresponding place. A recipe could for example look like this:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">recipe</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;input_data&quot;</span><span class="p">:</span> <span class="n">_types</span><span class="o">.</span><span class="n">InputDataExtComponentsMemoryview</span><span class="p">,</span>
    <span class="s2">&quot;fitter&quot;</span><span class="p">:</span> <span class="s2">&quot;bfs&quot;</span><span class="p">,</span>
    <span class="s2">&quot;fitter.getter&quot;</span><span class="p">:</span> <span class="s2">&quot;brute_force&quot;</span><span class="p">,</span>
    <span class="s2">&quot;fitter.getter.dgetter&quot;</span><span class="p">:</span> <span class="s2">&quot;metric&quot;</span><span class="p">,</span>
    <span class="s2">&quot;fitter.getter.dgetter.metric&quot;</span><span class="p">:</span> <span class="s2">&quot;euclidean&quot;</span><span class="p">,</span>
    <span class="s2">&quot;fitter.na&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;vector&quot;</span><span class="p">,</span> <span class="p">(),</span> <span class="p">{</span><span class="s2">&quot;initial_size&quot;</span><span class="p">:</span> <span class="mi">1000</span><span class="p">}),</span>
    <span class="s2">&quot;fitter.checker&quot;</span><span class="p">:</span> <span class="s2">&quot;contains&quot;</span><span class="p">,</span>
    <span class="s2">&quot;fitter.queue&quot;</span><span class="p">:</span> <span class="s2">&quot;fifo&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<p>In this recipe, the generic type supposed to wrap the input data is specified explicitly as the class object. Alternatively, strings can be used to specify a type in shorthand notation. Which abbreviations are understood is defined in the <code class="docutils literal notranslate"><span class="pre">recipes.COMPONENT_NAME_TYPE_MAP</span></code>. In the fitter case, <code class="docutils literal notranslate"><span class="pre">bfs</span></code> is translated into <code class="docutils literal notranslate"><span class="pre">_fit.FitterExtCommonNNBFS</span></code>. Dot notation is used to indicate nested dependencies, e.g. to define components needed to create other components. Similarly, shorthand notation
is supported for the component key, as shown with <code class="docutils literal notranslate"><span class="pre">fitter.getter</span></code> which stands in for the neighbours getter required by the fitter. Abbreviations on the key side are defined in <code class="docutils literal notranslate"><span class="pre">recipes.COMPONENT_ALT_KW_MAP</span></code>. For the <code class="docutils literal notranslate"><span class="pre">&quot;fitter.na&quot;</span></code> component (one of the neighbours container type needed that the fitter needs), we have a tuple as the value in the mapping. This is interpreted as a component string identifier, followed by an arguments tuple, and a keyword arguments dictionary used in the
initialisation of the corresponding component. Note also, that the recipe defines only <code class="docutils literal notranslate"><span class="pre">&quot;fitter.na&quot;</span></code> (<code class="docutils literal notranslate"><span class="pre">neighbours</span></code>) and not <code class="docutils literal notranslate"><span class="pre">&quot;fitter.nb&quot;</span></code> (<code class="docutils literal notranslate"><span class="pre">neighbour_neighbours</span></code>) in which case the same type will be used for both components. Those fallback relation ships are defined in <code class="docutils literal notranslate"><span class="pre">recipes.COMPONENT_KW_TYPE_ALIAS_MAP</span></code>. The above mentioned default recipes looks like the following:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">recipes</span><span class="o">.</span><span class="n">get_registered_recipe</span><span class="p">(</span><span class="s2">&quot;coordinates&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;input_data&#39;: &#39;components_mview&#39;,
 &#39;preparation_hook&#39;: &#39;components_array_from_parts&#39;,
 &#39;fitter&#39;: &#39;bfs&#39;,
 &#39;fitter.ngetter&#39;: &#39;brute_force&#39;,
 &#39;fitter.na&#39;: &#39;vuset&#39;,
 &#39;fitter.checker&#39;: &#39;switch&#39;,
 &#39;fitter.queue&#39;: &#39;fifo&#39;,
 &#39;fitter.ngetter.dgetter&#39;: &#39;metric&#39;,
 &#39;fitter.ngetter.dgetter.metric&#39;: &#39;euclidean_r&#39;}
</pre></div></div>
</div>
<p>On builder initialisation, a base recipe can be specified either as a string (if a corresponding recipe is registered) or as a mapping. Further keyword arguments are interpreted to override the base recipe.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">builder</span> <span class="o">=</span> <span class="n">recipes</span><span class="o">.</span><span class="n">Builder</span><span class="p">(</span><span class="n">recipe</span><span class="o">=</span><span class="n">recipe</span><span class="p">,</span> <span class="n">prep</span><span class="o">=</span><span class="s1">&#39;components_array_from_parts&#39;</span><span class="p">)</span>
<span class="n">builder</span><span class="o">.</span><span class="n">recipe</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;input_data&#39;: commonnn._types.InputDataExtComponentsMemoryview,
 &#39;fitter&#39;: &#39;bfs&#39;,
 &#39;fitter.neighbours_getter&#39;: &#39;brute_force&#39;,
 &#39;fitter.neighbours_getter.distance_getter&#39;: &#39;metric&#39;,
 &#39;fitter.neighbours_getter.distance_getter.metric&#39;: &#39;euclidean&#39;,
 &#39;fitter.neighbours&#39;: (&#39;vector&#39;, (), {&#39;initial_size&#39;: 1000}),
 &#39;fitter.similarity_checker&#39;: &#39;contains&#39;,
 &#39;fitter.queue&#39;: &#39;fifo&#39;,
 &#39;preparation_hook&#39;: &#39;components_array_from_parts&#39;}
</pre></div></div>
</div>
<p>Other readily available recipes are <code class="docutils literal notranslate"><span class="pre">&quot;distances&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;neighbourhoods&quot;</span></code> and <code class="docutils literal notranslate"><span class="pre">&quot;sorted_neighbourhoods&quot;</span></code>. The users are encouraged to modify those to their liking or to define their own custom recipes.</p>
<p>Individual components are build by the builder after initialisation by calling its <code class="docutils literal notranslate"><span class="pre">make_component</span></code> method.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fitter</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">make_component</span><span class="p">(</span><span class="s2">&quot;fitter&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">fitter</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
FitterExtCommonNNBFS(ngetter=NeighboursGetterExtBruteForce(dgetter=DistanceGetterExtMetric(metric=MetricExtEuclidean), sorted=False, selfcounting=True), na=NeighboursExtVector, nb=NeighboursExtVector, checker=SimilarityCheckerExtContains, queue=QueueExtFIFOQueue)
</pre></div></div>
</div>
<p>Generic input data is made from raw input data by <code class="docutils literal notranslate"><span class="pre">make_input_data</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">input_data</span> <span class="o">=</span> <span class="n">builder</span><span class="o">.</span><span class="n">make_input_data</span><span class="p">(</span><span class="n">points</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
InputDataExtComponentsMemoryview(components of 3 points in 3 dimensions)
</pre></div></div>
</div>
<p>Newly defined types that should be usable in a builder controlled aggregation need to implement a classmethod <code class="docutils literal notranslate"><span class="pre">get_builder_kwargs()</span> <span class="pre">-&gt;</span> <span class="pre">list</span></code> that provides a list of component identifiers necessary to initialise an object of itself.</p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">CommonNN Clustering</a></h1>



<p class="blurb">A Python package for common-nearest-neighbour clustering</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=bkellerlab&repo=CommonNNClustering&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../_source/install.html">Installation instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../_source/quickstart.html">Quickstart</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../_source/tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="basic_usage.html">Basic usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="scikit_learn_datasets.html">Clustering of scikit-learn toy data sets</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Advanced usage</a></li>
<li class="toctree-l2"><a class="reference internal" href="interface_demo.html">Demonstration of (generic) interfaces</a></li>
<li class="toctree-l2"><a class="reference internal" href="hierarchical_clustering_basics.html">Hierarchical clustering basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="algorithm_explained.html">Density-based clustering basics</a></li>
<li class="toctree-l2"><a class="reference internal" href="md_example.html">Molecular dynamics application example</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../_source/api_reference.html">API Reference</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../_source/tutorials.html">Tutorials</a><ul>
      <li>Previous: <a href="scikit_learn_datasets.html" title="previous chapter">Clustering of scikit-learn toy data sets</a></li>
      <li>Next: <a href="interface_demo.html" title="next chapter">Demonstration of (generic) interfaces</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2022, Jan-Oliver Kapp-Joswig.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.4.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../_sources/tutorial/advanced_usage.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>